<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="QA seven's blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="实现你第一个自动化场景万事俱备，只欠东风，让我们来实现我们一个自动化测试场景，百度上搜索capybara。
123456789101112131415describe &quot;i want search capybara&quot;,  :type =&amp;gt; :feature do    context &apos;i need to open browser&apos; do      it &apos;should be  has an">
<meta property="og:type" content="article">
<meta property="og:title" content="capybara5--实现你第一个自动化场景">
<meta property="og:url" content="http://yoursite.com/2016/09/01/capybara5/index.html">
<meta property="og:site_name" content="QA seven's blog">
<meta property="og:description" content="实现你第一个自动化场景万事俱备，只欠东风，让我们来实现我们一个自动化测试场景，百度上搜索capybara。
123456789101112131415describe &quot;i want search capybara&quot;,  :type =&amp;gt; :feature do    context &apos;i need to open browser&apos; do      it &apos;should be  has an">
<meta property="og:updated_time" content="2016-09-06T05:43:25.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="capybara5--实现你第一个自动化场景">
<meta name="twitter:description" content="实现你第一个自动化场景万事俱备，只欠东风，让我们来实现我们一个自动化测试场景，百度上搜索capybara。
123456789101112131415describe &quot;i want search capybara&quot;,  :type =&amp;gt; :feature do    context &apos;i need to open browser&apos; do      it &apos;should be  has an">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2016/09/01/capybara5/"/>





  <title>capybara5--实现你第一个自动化场景 | QA seven's blog</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">QA seven's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            標籤
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/01/capybara5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qi lei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QA seven's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">capybara5--实现你第一个自动化场景</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2016-09-01T22:31:15+08:00">
                2016-09-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="u5B9E_u73B0_u4F60_u7B2C_u4E00_u4E2A_u81EA_u52A8_u5316_u573A_u666F"><a href="#u5B9E_u73B0_u4F60_u7B2C_u4E00_u4E2A_u81EA_u52A8_u5316_u573A_u666F" class="headerlink" title="实现你第一个自动化场景"></a>实现你第一个自动化场景</h2><p>万事俱备，只欠东风，让我们来实现我们一个自动化测试场景，百度上搜索capybara。</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">describe <span class="string">"i want search capybara"</span>,  :type =&gt; :feature <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    context <span class="comment">'i need to open browser' do</span></span><br><span class="line">      it <span class="comment">'should be  has an browser'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">    context <span class="comment">'when i input baidu url into the browser textarea' do</span></span><br><span class="line">      it <span class="comment">'should be redirect  to the baidu homepage'</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">    context <span class="comment">'when i input the capybara into search text ' do</span></span><br><span class="line">      it <span class="comment">'responds with 200 and show the result'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<hr>
<p>rspec 与 cucumber完整的使用指南并不包含在本书的范畴，但我会给大家讲解基本的项目架构与语法，帮助大家更好的理解capybara和自动化测试的规范。</p>
<h3 id="rspec_u65B9_u5F0F"><a href="#rspec_u65B9_u5F0F" class="headerlink" title="rspec方式"></a>rspec方式</h3><p>对于基于rspec框架的项目，我们首先需要创建spec目录，来将我们的测试文件放置当中，这样做使我们项目代码结构更加清晰。<br>此外我们还需要创建spec/rspec_help.rb文件帮助我们设置测试的配置信息。</p>
<p>如果你的项目是基于rails的，那么就更简单了，你只需要执行以下命令，系统就帮助我们完成这些基础配置和文件的生成</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails generate rspec:<span class="keyword">install</span></span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.rspec</span></span><br><span class="line">spec/spec_helper<span class="class">.rb</span></span><br><span class="line">spec/rails_helper.rb</span><br></pre></td></tr></table></figure>
<p>让我正式开始<br>首先我们需要配置spec_helper.rb文件，<br>将以下内容复制到spec_helper.rb中，稍后章节中我将具体介绍配置文件中每条代码实际的作用</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">require <span class="string">"capybara/rspec"</span></span><br><span class="line">require <span class="string">"capybara"</span></span><br><span class="line">require <span class="string">"rspec"</span></span><br><span class="line">require <span class="string">'pry'</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Capybara.</span>default_driver = <span class="symbol">:selenium</span></span><br><span class="line"><span class="constant">Capybara.</span>app_host = <span class="string">'http://www.baidu.com'</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Capybara.</span>register_driver <span class="symbol">:selenium</span> <span class="keyword">do</span> |app| <span class="constant">Capybara:</span><span class="symbol">:Selenium</span><span class="symbol">:</span><span class="symbol">:Driver</span>.new(</span><br><span class="line">app, <span class="symbol">:browser</span> =&gt; <span class="symbol">:chrome</span> )</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This file was generated by the `rspec --init` command. Conventionally, all</span></span><br><span class="line"><span class="comment"># specs live under a `spec` directory, which RSpec adds to the `$LOAD_PATH`.</span></span><br><span class="line"><span class="comment"># The generated `.rspec` file contains `--require spec_helper` which will cause</span></span><br><span class="line"><span class="comment"># this file to always be loaded, without a need to explicitly require it in any</span></span><br><span class="line"><span class="comment"># files.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Given that it is always loaded, you are encouraged to keep this file as</span></span><br><span class="line"><span class="comment"># light-weight as possible. Requiring heavyweight dependencies from this file</span></span><br><span class="line"><span class="comment"># will add to the boot time of your test suite on EVERY test run, even for an</span></span><br><span class="line"><span class="comment"># individual file that may not need all of that loaded. Instead, consider making</span></span><br><span class="line"><span class="comment"># a separate helper file that requires the additional dependencies and performs</span></span><br><span class="line"><span class="comment"># the additional setup, and require it from the spec files that actually need</span></span><br><span class="line"><span class="comment"># it.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The `.rspec` file also contains a few flags that are not defaults but that</span></span><br><span class="line"><span class="comment"># users commonly want.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See http://rubydoc.info/gems/rspec-core/RSpec/Core/Configuration</span></span><br><span class="line"><span class="constant">RSpec.</span>configure <span class="keyword">do</span> |config|</span><br><span class="line"></span><br><span class="line">  <span class="comment"># rspec-expectations config goes here. You can use an alternate</span></span><br><span class="line">  <span class="comment"># assertion/expectation library such as wrong or the stdlib/minitest</span></span><br><span class="line">  <span class="comment"># assertions if you prefer.</span></span><br><span class="line"></span><br><span class="line">  config.expect_with <span class="symbol">:rspec</span> <span class="keyword">do</span> |expectations|</span><br><span class="line">    <span class="comment"># This option will default to `true` in RSpec 4. It makes the `description`</span></span><br><span class="line">    <span class="comment"># and `failure_message` of custom matchers include text for helper methods</span></span><br><span class="line">    <span class="comment"># defined using `chain`, e.g.:</span></span><br><span class="line">    <span class="comment">#     be_bigger_than(2).and_smaller_than(4).description</span></span><br><span class="line">    <span class="comment">#     # =&gt; "be bigger than 2 and smaller than 4"</span></span><br><span class="line">    <span class="comment"># ...rather than:</span></span><br><span class="line">    <span class="comment">#     # =&gt; "be bigger than 2"</span></span><br><span class="line">    expectations.include_chain_clauses_in_custom_matcher_descriptions = <span class="keyword">true</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># rspec-mocks config goes here. You can use an alternate test double</span></span><br><span class="line">  <span class="comment"># library (such as bogus or mocha) by changing the `mock_with` option here.</span></span><br><span class="line">  config.mock_with <span class="symbol">:rspec</span> <span class="keyword">do</span> |mocks|</span><br><span class="line">    <span class="comment"># Prevents you from mocking or stubbing a method that does not exist on</span></span><br><span class="line">    <span class="comment"># a real object. This is generally recommended, and will default to</span></span><br><span class="line">    <span class="comment"># `true` in RSpec 4.</span></span><br><span class="line">    mocks.verify_partial_doubles = <span class="keyword">true</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># This option will default to `:apply_to_host_groups` in RSpec 4 (and will</span></span><br><span class="line">  <span class="comment"># have no way to turn it off -- the option exists only for backwards</span></span><br><span class="line">  <span class="comment"># compatibility in RSpec 3). It causes shared context metadata to be</span></span><br><span class="line">  <span class="comment"># inherited by the metadata hash of host groups and examples, rather than</span></span><br><span class="line">  <span class="comment"># triggering implicit auto-inclusion in groups with matching metadata.</span></span><br><span class="line">  config.shared_context_metadata_behavior = <span class="symbol">:apply_to_host_groups</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The settings below are suggested to provide a good initial experience</span></span><br><span class="line"><span class="comment"># with RSpec, but feel free to customize to your heart's content.</span></span><br><span class="line">=<span class="keyword">begin</span></span><br><span class="line">  <span class="comment"># This allows you to limit a spec run to individual examples or groups</span></span><br><span class="line">  <span class="comment"># you care about by tagging them with `:focus` metadata. When nothing</span></span><br><span class="line">  <span class="comment"># is tagged with `:focus`, all examples get run. RSpec also provides</span></span><br><span class="line">  <span class="comment"># aliases for `it`, `describe`, and `context` that include `:focus`</span></span><br><span class="line">  <span class="comment"># metadata: `fit`, `fdescribe` and `fcontext`, respectively.</span></span><br><span class="line">  config.filter_run_when_matching <span class="symbol">:focus</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Allows RSpec to persist some state between runs in order to support</span></span><br><span class="line">  <span class="comment"># the `--only-failures` and `--next-failure` CLI options. We recommend</span></span><br><span class="line">  <span class="comment"># you configure your source control system to ignore this file.</span></span><br><span class="line">  config.example_status_persistence_file_path = <span class="string">"spec/examples.txt"</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Limits the available syntax to the non-monkey patched syntax that is</span></span><br><span class="line">  <span class="comment"># recommended. For more details, see:</span></span><br><span class="line">  <span class="comment">#   - http://rspec.info/blog/2012/06/rspecs-new-expectation-syntax/</span></span><br><span class="line">  <span class="comment">#   - http://www.teaisaweso.me/blog/2013/05/27/rspecs-new-message-expectation-syntax/</span></span><br><span class="line">  <span class="comment">#   - http://rspec.info/blog/2014/05/notable-changes-in-rspec-3/#zero-monkey-patching-mode</span></span><br><span class="line">  config.disable_monkey_patching!</span><br><span class="line"></span><br><span class="line">  <span class="comment"># This setting enables warnings. It's recommended, but in some cases may</span></span><br><span class="line">  <span class="comment"># be too noisy due to issues in dependencies.</span></span><br><span class="line">  config.warnings = <span class="keyword">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Many RSpec users commonly either run the entire suite or an individual</span></span><br><span class="line">  <span class="comment"># file, and it's useful to allow more verbose output when running an</span></span><br><span class="line">  <span class="comment"># individual spec file.</span></span><br><span class="line">  if config.files_to_run.one?</span><br><span class="line">    <span class="comment"># Use the documentation formatter for detailed output,</span></span><br><span class="line">    <span class="comment"># unless a formatter has already been configured</span></span><br><span class="line">    <span class="comment"># (e.g. via a command-line flag).</span></span><br><span class="line">    config.default_formatter = <span class="string">'doc'</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Print the 10 slowest examples and example groups at the</span></span><br><span class="line">  <span class="comment"># end of the spec run, to help surface which specs are running</span></span><br><span class="line">  <span class="comment"># particularly slow.</span></span><br><span class="line">  config.profile_examples = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Run specs in random order to surface order dependencies. If you find an</span></span><br><span class="line">  <span class="comment"># order dependency and want to debug it, you can fix the order by providing</span></span><br><span class="line">  <span class="comment"># the seed, which is printed after each run.</span></span><br><span class="line">  <span class="comment">#     --seed 1234</span></span><br><span class="line">  config.order = <span class="symbol">:random</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Seed global randomization in this process using the `--seed` CLI option.</span></span><br><span class="line">  <span class="comment"># Setting this allows you to use `--seed` to deterministically reproduce</span></span><br><span class="line">  <span class="comment"># test failures related to randomization by passing the same `--seed` value</span></span><br><span class="line">  <span class="comment"># as the one that triggered the failure.</span></span><br><span class="line">  <span class="constant">Kernel.</span>srand config.seed</span><br><span class="line">=<span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>我们执行以下命令来运行我们的测试</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lqi @ CNlqi in ~/work/test/capybara_demo on git:master x [22:00:31]</span></span><br><span class="line">$ rspec ./spec/features/baidusearch_spec.rb</span><br><span class="line">***</span><br><span class="line"></span><br><span class="line"><span class="type">Pending</span>: (<span class="type">Failures</span> listed here are expected <span class="keyword">and</span> <span class="keyword">do</span> <span class="keyword">not</span> affect your suite's status)</span><br><span class="line"></span><br><span class="line">  <span class="number">1</span>) i want search capybara i need to open browser should be  has an browser</span><br><span class="line">     <span class="comment"># Not yet implemented</span></span><br><span class="line">     <span class="comment"># ./spec/features/bb_spec.rb:9</span></span><br><span class="line"></span><br><span class="line">  <span class="number">2</span>) i want search capybara <span class="keyword">when</span> i input baidu url into the browser textarea should be redirect  to the baidu homepage</span><br><span class="line">     <span class="comment"># Not yet implemented</span></span><br><span class="line">     <span class="comment"># ./spec/features/bb_spec.rb:16</span></span><br><span class="line"></span><br><span class="line">  <span class="number">3</span>) i want search capybara <span class="keyword">when</span> i input the capybara into search text  responds <span class="keyword">with</span> <span class="number">200</span> <span class="keyword">and</span> show the <span class="literal">result</span></span><br><span class="line">     <span class="comment"># Not yet implemented</span></span><br><span class="line">     <span class="comment"># ./spec/features/bb_spec.rb:20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">Finished</span> <span class="keyword">in</span> <span class="number">0</span>.<span class="number">00059</span> seconds (files took <span class="number">1</span>.<span class="number">37</span> seconds to load)</span><br><span class="line"><span class="number">3</span> examples, <span class="number">0</span> failures, <span class="number">3</span> pending</span><br></pre></td></tr></table></figure>
<p>我们从测试结果能看出，我们并没有实现任何具体操作步骤，接下就让我们完成这些工作。<br>将我们测试文件baidusearch_spec.rb修改为以下内容</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">describe</span> <span class="string">"i want search capybara"</span>,  :<span class="keyword">type</span> =&gt; :feature <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">context</span> <span class="string">"the page"</span> <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">before</span> <span class="keyword">do</span></span><br><span class="line">      page.driver.browser.manage.window.resize_to(<span class="number">1440</span>,<span class="number">900</span>) #Mention it here</span><br><span class="line">      visit <span class="string">"/"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">context</span> <span class="string">'i need to open browser'</span> <span class="keyword">do</span></span><br><span class="line">      it <span class="string">'should be  has an browser'</span> <span class="keyword">do</span></span><br><span class="line">      expect(page.driver.browser.browser).<span class="keyword">to</span> eq :chrome</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">context</span> <span class="string">'when i input baidu url into the browser textarea'</span> <span class="keyword">do</span></span><br><span class="line">      it <span class="string">'should be redirect  to the baidu homepage'</span> <span class="keyword">do</span></span><br><span class="line">       expect(page.driver.current_url).<span class="keyword">to</span> eq(<span class="string">'https://www.baidu.com/'</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">    <span class="keyword">context</span> <span class="string">'when i input the capybara into search text '</span> <span class="keyword">do</span></span><br><span class="line">      it <span class="string">' show search the result'</span> <span class="keyword">do</span></span><br><span class="line">        fill_in <span class="string">'kw'</span>, :<span class="keyword">with</span> =&gt; <span class="string">'capybara'</span></span><br><span class="line">        click_button <span class="string">'百度一下'</span></span><br><span class="line">        expect(page).<span class="keyword">to</span> have_content <span class="string">'Capybara - Wikipedia, the free encyclopedia'</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span></span><br></pre></td></tr></table></figure>
<p>再次运行测试<br>这时浏览器打开并且按照我们测试文件中具体步骤一步一步进行操作和验证，全部通过</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># lqi @ CNlqi in ~/work/test/capybara_demo on git:master x [<span class="number">22</span>:<span class="number">26</span>:<span class="number">15</span>] C:<span class="number">1</span></span></span><br><span class="line">$ rspec ./spec/features/baidusearch_spec.rb</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Finished in <span class="number">5.46</span> seconds (files took <span class="number">3.81</span> seconds to load)</span><br><span class="line"><span class="number">3</span> examples, <span class="number">0</span> failures</span><br></pre></td></tr></table></figure>
<h3 id="cucumber_u65B9_u5F0F"><a href="#cucumber_u65B9_u5F0F" class="headerlink" title="cucumber方式"></a>cucumber方式</h3><p>首先我们运行cucumber查看cucumber是否安装正确<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># lqi @ CNlqi <span class="keyword">in</span> ~/work/<span class="keyword">test</span>/capybara_demo <span class="keyword">on</span> git:master x [13:42:41]</span><br><span class="line">$ cucumber</span><br><span class="line"><span class="keyword">No</span> such <span class="keyword">file</span> or directory - features. You can <span class="keyword">use</span> `cucumber --init` to get started.</span><br></pre></td></tr></table></figure></p>
<p>当我们看到以上提示没有文件或者目录时，我们就可以确认cucumber安装成功<br>接下来让我们初始化cucumber测试目录结构<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lqi @ CNlqi in ~/work/test/capybara_demo on git:master x [11:24:56] C:2</span></span><br><span class="line">$ cucumber <span class="comment">--init</span></span><br><span class="line">  <span class="built_in">create</span>   features</span><br><span class="line">  <span class="built_in">create</span>   features/step_definitions</span><br><span class="line">  <span class="built_in">create</span>   features/support</span><br><span class="line">  <span class="built_in">create</span>   features/support/env.rb</span><br></pre></td></tr></table></figure></p>
<p>这样就完成目录结构的初始化，我们要将所有feature文件都放到features目录下<br>support目录下，使我们需要的一些配置文件.</p>
<p>step<em>definitions目录下，是对feature文件中的具体操作实现。因为我们都知道feature文件中只是做了一些描述，具体的执行是放到step</em> definitions下面的文件里面的。<br>接下来，我们用cucumber完成和上面spec一样的场景。<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Feature</span>: <span class="type">Search</span> <span class="keyword">for</span> capybara on baidu</span><br><span class="line">      <span class="type">Scenario</span>: <span class="type">Search</span> <span class="keyword">for</span> website <span class="keyword">of</span> baidu</span><br><span class="line">          <span class="type">Given</span> I am on the baidu home page</span><br><span class="line">          <span class="type">When</span> I search <span class="keyword">for</span> <span class="string">"capybara"</span></span><br><span class="line">          <span class="type">Then</span> website <span class="keyword">of</span> search <span class="literal">result</span> are returned</span><br></pre></td></tr></table></figure></p>
<p>在命令行中运行cucumber命令，<br>运行上述测试用例，便可以看到下列输出，你可以使用下面的代码段实现步骤定义：<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lqi @ CNlqi in ~/work/test/capybara_demo on git:master x [14:25:16] C:1</span></span><br><span class="line">$ cucumber</span><br><span class="line">Feature: Search <span class="keyword">for</span> capybara <span class="command"><span class="keyword">on</span> <span class="title">baidu</span></span></span><br><span class="line"></span><br><span class="line">  Scenario: Search <span class="keyword">for</span> website <span class="operator">of</span> baidu        <span class="comment"># features/baidu_search_capybara.feature:2</span></span><br><span class="line">    Given I am <span class="command"><span class="keyword">on</span> <span class="title">the</span> <span class="title">baidu</span> <span class="title">home</span> <span class="title">page</span>          # <span class="title">features</span>/<span class="title">baidu_search_capybara</span>.<span class="title">feature</span>:<span class="title">3</span></span></span><br><span class="line">    When I search <span class="keyword">for</span> <span class="string">"capybara"</span>               <span class="comment"># features/baidu_search_capybara.feature:4</span></span><br><span class="line">    Then website <span class="operator">of</span> search <span class="built_in">result</span> are returned <span class="comment"># features/baidu_search_capybara.feature:5</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span> scenario (<span class="number">1</span> undefined)</span><br><span class="line"><span class="number">3</span> steps (<span class="number">3</span> undefined)</span><br><span class="line"><span class="number">0</span>m0<span class="number">.395</span>s</span><br><span class="line"></span><br><span class="line">You can implement step definitions <span class="keyword">for</span> undefined steps <span class="operator">with</span> these snippets:</span><br><span class="line"></span><br><span class="line">Given(/^I am <span class="command"><span class="keyword">on</span> <span class="title">the</span> <span class="title">baidu</span> <span class="title">home</span> <span class="title">page</span>$/) <span class="title">do</span></span></span><br><span class="line">  pending <span class="comment"># Write code here that turns the phrase above into concrete actions</span></span><br><span class="line"><span class="function"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="title">When</span>(/^<span class="title">I</span> <span class="title">search</span> <span class="title">for</span> "([^"]*)"$/) <span class="title">do</span> |<span class="title">arg1</span>|</span></span><br><span class="line">  pending <span class="comment"># Write code here that turns the phrase above into concrete actions</span></span><br><span class="line"><span class="function"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="title">Then</span>(/^<span class="title">website</span> <span class="title">of</span> <span class="title">search</span> <span class="title">result</span> <span class="title">are</span> <span class="title">returned</span>$/) <span class="title">do</span></span></span><br><span class="line">  pending <span class="comment"># Write code here that turns the phrase above into concrete actions</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>复制以上代码到具体step.rb文件中，我们新建文件capybara_search_step.rb。<br>再次运行cucumber命令<br>现在,您将看到命令行报告,这些步骤已经存在但没有实现:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># lqi @ CNlqi in ~/work/test/capybara_demo on git:master x [<span class="number">14</span>:<span class="number">25</span>:<span class="number">22</span>]</span></span><br><span class="line">$ cucumber</span><br><span class="line">Feature: Search <span class="keyword">for</span> capybara on baidu</span><br><span class="line"></span><br><span class="line">  Scenario: Search <span class="keyword">for</span> website of baidu        <span class="preprocessor"># features/baidu_search_capybara.feature:<span class="number">2</span></span></span><br><span class="line">    Given I am on the baidu home page          <span class="preprocessor"># features/step_definitions/capybara_search_step.rb:<span class="number">1</span></span></span><br><span class="line">      TODO (Cucumber::Pending)</span><br><span class="line">      ./features/step_definitions/capybara_search_step.rb:<span class="number">2</span>:in `/^I am on the baidu home page$/'</span><br><span class="line">      features/baidu_search_capybara.feature:<span class="number">3</span>:in `Given I am on the baidu home page'</span><br><span class="line">    When I search <span class="keyword">for</span> <span class="string">"capybara"</span>               <span class="preprocessor"># features/step_definitions/capybara_search_step.rb:<span class="number">5</span></span></span><br><span class="line">    Then website of search result are returned <span class="preprocessor"># features/step_definitions/capybara_search_step.rb:<span class="number">9</span></span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span> scenario (<span class="number">1</span> pending)</span><br><span class="line"><span class="number">3</span> steps (<span class="number">2</span> skipped, <span class="number">1</span> pending)</span><br><span class="line"><span class="number">0</span>m0<span class="number">.152</span>s</span><br></pre></td></tr></table></figure></p>
<p>接下来，我们通过增加少量的代码来使我们自动化运行起来。<br>首先确保你的env.rb文件配置如下：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'capybara/cucumber'</span></span><br><span class="line"><span class="constant">Capybara</span>.default_driver = <span class="symbol">:selenium</span></span><br></pre></td></tr></table></figure></p>
<p>首先，我们在文件中添加require ‘capybara/cucumber’;<br>这是我们必须需要加载文件。<br>之后我们需要告诉capybara使用selenium驱动：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Capybara<span class="class">.default_driver</span> = :selenium</span><br></pre></td></tr></table></figure></p>
<p>再次重申，capybara只是充当一个中间件，适配不同的dirver,使我们能够兼容任何的驱动程序,例如（Selecting the Driver，<br>RackTest，<br>Selenium，<br>Capybara-webkit，<br>Poltergeist）这里我们选择selemium webdriver 是因为它是目前最流行的开源浏览器自动化工具，很多公司的自动化框架都是基于它之上的二次开发而成，例如appium，淘宝的Automan X,网易Dagger等。</p>
<p>如果我们不设置驱动，将会得到以下错误<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lqi @ CNlqi in ~/work/test/capybara_demo on git:master x [17:13:47] C:2</span></span><br><span class="line"><span class="variable">$ </span>cucumber</span><br><span class="line">rack-test requires a rack application, but none was given (<span class="constant">ArgumentError</span>)</span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">capybara</span>-2.8.0/<span class="title">lib</span>/<span class="title">capybara</span>/<span class="title">rack_test</span>/<span class="title">driver</span>.<span class="title">rb</span>:17:<span class="title">in</span> `<span class="title">initialize</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">capybara</span>-2.8.0/<span class="title">lib</span>/<span class="title">capybara</span>.<span class="title">rb</span>:509:<span class="title">in</span> `<span class="title">new</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">capybara</span>-2.8.0/<span class="title">lib</span>/<span class="title">capybara</span>.<span class="title">rb</span>:509:<span class="title">in</span> `<span class="title">block</span> <span class="title">in</span> &lt;<span class="title">top</span> (<span class="title">required</span>)&gt;'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">capybara</span>-2.8.0/<span class="title">lib</span>/<span class="title">capybara</span>/<span class="title">session</span>.<span class="title">rb</span>:85:<span class="title">in</span> `<span class="title">call</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">capybara</span>-2.8.0/<span class="title">lib</span>/<span class="title">capybara</span>/<span class="title">session</span>.<span class="title">rb</span>:85:<span class="title">in</span> `<span class="title">driver</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/work/test/capybara_demo/features/support/env.<span class="symbol">rb:</span><span class="number">12</span>:in <span class="string">`&lt;top (required)&gt;'</span><br><span class="line">/Users/lqi/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/cucumber-2.4.0/lib/cucumber/rb_support/rb_language.rb:96:in `</span>load<span class="string">'</span><br><span class="line">/Users/lqi/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/cucumber-2.4.0/lib/cucumber/rb_support/rb_language.rb:96:in `load_code_file'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">cucumber</span>-2.4.0/<span class="title">lib</span>/<span class="title">cucumber</span>/<span class="title">runtime</span>/<span class="title">support_code</span>.<span class="title">rb</span>:142:<span class="title">in</span> `<span class="title">load_file</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">cucumber</span>-2.4.0/<span class="title">lib</span>/<span class="title">cucumber</span>/<span class="title">runtime</span>/<span class="title">support_code</span>.<span class="title">rb</span>:84:<span class="title">in</span> `<span class="title">block</span> <span class="title">in</span> <span class="title">load_files!</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">cucumber</span>-2.4.0/<span class="title">lib</span>/<span class="title">cucumber</span>/<span class="title">runtime</span>/<span class="title">support_code</span>.<span class="title">rb</span>:83:<span class="title">in</span> `<span class="title">each</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">cucumber</span>-2.4.0/<span class="title">lib</span>/<span class="title">cucumber</span>/<span class="title">runtime</span>/<span class="title">support_code</span>.<span class="title">rb</span>:83:<span class="title">in</span> `<span class="title">load_files!</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">cucumber</span>-2.4.0/<span class="title">lib</span>/<span class="title">cucumber</span>/<span class="title">runtime</span>.<span class="title">rb</span>:253:<span class="title">in</span> `<span class="title">load_step_definitions</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">cucumber</span>-2.4.0/<span class="title">lib</span>/<span class="title">cucumber</span>/<span class="title">runtime</span>.<span class="title">rb</span>:61:<span class="title">in</span> `<span class="title">run!</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">cucumber</span>-2.4.0/<span class="title">lib</span>/<span class="title">cucumber</span>/<span class="title">cli</span>/<span class="title">main</span>.<span class="title">rb</span>:32:<span class="title">in</span> `<span class="title">execute!</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">cucumber</span>-2.4.0/<span class="title">bin</span>/<span class="title">cucumber</span>:8:<span class="title">in</span> `&lt;<span class="title">top</span> (<span class="title">required</span>)&gt;'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/bin/<span class="symbol">cucumber:</span><span class="number">23</span>:in <span class="string">`load'</span><br><span class="line">/Users/lqi/.rbenv/versions/2.2.2/bin/cucumber:23:in `</span>&lt;main&gt;<span class="string">'</span></span><br></pre></td></tr></table></figure></p>
<p>默认情况下，capybara被用来测试rack 应用。rack 是一个设计非常巧妙的中间件，被用作在rails与sinatra框架做全栈的Client/Server集成测试，并且没有什么HTTP的开销，从而是测试能够快速运行。稍后，我们将详细介绍capybara如何测试在rails与sinatra的应用测试。<br>接下来我们的任务就是你在步骤定义用Ruby代码调用capybaraAPI驱动测试。<br>将以下代码复制到你的capybara_search_step.rb中<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">Given</span>(<span class="regexp">/^I am on the baidu home page$/</span>) <span class="keyword">do</span></span><br><span class="line">  visit <span class="string">'https://www.baidu.com/'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="constant">When</span>(<span class="regexp">/^I search for "([^"]*)"$/</span>) <span class="keyword">do</span> |search_term|</span><br><span class="line">  fill_in <span class="string">'kw'</span>, <span class="symbol">:with</span> =&gt; search_term</span><br><span class="line">  click_on <span class="string">'su'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Then</span>(<span class="regexp">/^website of search result are returned$/</span>) <span class="keyword">do</span></span><br><span class="line">     page.should have_content <span class="string">'capybara'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>在我们分析代码之前,让我们先运行测试,看看会发生什么。像往常一样,在命令行中输入cucumber。<br>希望你能看到chrome打开，并且跳转到baidu首页，之后搜索到capybara结果并返回。<br>恭喜你，你已经利用capybara完成了第一个全栈的集成测试。</p>
<p>在我们深入了解capybara丰富的API之前，让我们简要的回顾一下每个步骤的内容，这里你可以看到capybra如何优雅而简洁使用api，代码字面含义已经向我们展示它在干什么，不需要多解释。cucumber和capybra配合起来使用，具有良好的可读性，项目中的任何一个角色都能够当前场景做了哪些事情，非常适合应用于自动化和维护工作。<br>第一行代码告诉capybara通知driver（selenium webdriver）<br>打开一个浏览器并跳转到我们提供的链接地址：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">visit</span> <span class="string">'https://www.baidu.com/'</span></span><br></pre></td></tr></table></figure></p>
<p>  接下来，我们需要输入查询条件，点击搜索按钮，所以我们告诉capybara去让driver在页面上查找搜输入栏，并填写搜索条件。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fill_in <span class="string">'kw'</span>, :<span class="keyword">with</span> =&gt; search_term</span><br><span class="line"></span><br><span class="line">click_on <span class="string">'su'</span></span><br></pre></td></tr></table></figure>
<p>这里唯一的困惑是fill_in 方法中使用’kw’这个关键字，当你代码告诉capybara去在页面上寻找<br>这个关键字时，capybara使用了一种’猜测’的机制。<br>也就是说capybra试图在DOM元素各种属性中找到你要求的。在这个例子中,我们知道baidu搜索表栏的id属性kw，这是我们需要在代码中提供的。<br>最后,我们需要检查返回的搜索结果是否正确。为此,我们使用capybara的内置RSpec匹配器。如果你不知道RSpec,rspec官方文档是你最好的选择(<a href="http://rspec.info/),与传统断言不同是当条件不满足时，会抛出异常，而不是只是返回false" target="_blank" rel="external">http://rspec.info/),与传统断言不同是当条件不满足时，会抛出异常，而不是只是返回false</a></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">page<span class="class">.should</span> have_content <span class="string">'capybara'</span></span><br></pre></td></tr></table></figure>
<p>最后需要注意的是,have_content方法的匹配器内置了一个默认的等待。这是非常有用的,因为如果查找的内容我是通过JavaScript异步加载而成的话(而不是在初始页面就加载完成),capybara在我们设置默认等待时间重试,看它是否存在。我们将在后面的章节介绍如何处理异步JavaScript的问题。</p>
<p>总结，本章目标是让你认识capybra，以及配置它的运行环境，ruby和rubygems以及相关依赖。最后，我们通过一个简单的场景来编写自动化，来加强我们的学习。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/08/30/capybara4/" rel="next" title="capybara4--安装cucumber">
                <i class="fa fa-chevron-left"></i> capybara4--安装cucumber
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/10/31/qaquilty/" rel="prev" title="从QA的角度来谈谈代码质量的改进">
                从QA的角度来谈谈代码质量的改进 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目錄
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            本站概覽
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="qi lei" />
          <p class="site-author-name" itemprop="name">qi lei</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">文章</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">標籤</span>
              
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#u5B9E_u73B0_u4F60_u7B2C_u4E00_u4E2A_u81EA_u52A8_u5316_u573A_u666F"><span class="nav-number">1.</span> <span class="nav-text">实现你第一个自动化场景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#rspec_u65B9_u5F0F"><span class="nav-number">1.1.</span> <span class="nav-text">rspec方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cucumber_u65B9_u5F0F"><span class="nav-number">1.2.</span> <span class="nav-text">cucumber方式</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qi lei</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  








  






  





  

  

  

  

  

  

</body>
</html>
