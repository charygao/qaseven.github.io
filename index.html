<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="QA seven's blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="QA seven's blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="QA seven's blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="QA seven's blog">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>QA seven's blog</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">QA seven's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/06/devopsforqa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qi lei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QA seven's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/06/devopsforqa/" itemprop="url">2017年qa应掌握的技能</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-06T11:24:00+08:00">
                2017-04-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="DevOps__26amp_3B__u654F_u6377_u65B9_u6CD5"><a href="#DevOps__26amp_3B__u654F_u6377_u65B9_u6CD5" class="headerlink" title="DevOps &amp; 敏捷方法"></a>DevOps &amp; 敏捷方法</h2><p>随着对于在交付期限内完成项目的迫切需求，测试人员需要学习敏捷方法和DevOps，因为它们可以帮助促进团队之间的协作和改进迭代间工作模式。敏捷方法为测试项目提供了项目开发所需要速度与效率，而DevOps可以从开发，分析和质量保证流程中协助跨职能的团队合作，从而在更短的时间内产生出高质量的产品。此外，学习这些方法最终消除了角色间僵化和孤岛，让团队密切关注开发流程和持续发布。<br><img src="/image/timg.jpeg" alt="devops"><br>向上面devops工作流一样，devops 打通项目流程每一个环节，从代码的管理，到build、test 到最好部署到prod环境，对于qa来说，了解其中的流程，对于qa工作有非常的好处，通过devops一些监控工具例如airbrake我们可以实施查看系统发生的问题，与dev一起分析问题发生的原因，通过GA newrelic这些工具，我们可以分析系统用户行为，给系统性能测试与分析提供数据上的支持。通过对于了解devops工作流，我们可以分析项目中存在风险，及时改进流程，通过docker等容器化的工具，我们可以将测试放到容器中执行，降低测试对于环境的依赖，进一步改进自动化测试，所以说了解devops知识对于qa来说百利无一害，何乐而不为呢。</p>
<p>自动化<br>面对应用程序日益增加复杂性和系统集成，依靠手动测试已经无法完成全部测试工作。为了测试浏览器兼容性，性能，无头以及数据库和集成层面，测试人员应该学习自动化相关的技能，因为它可以提供业务逻辑和技术层面更高更准确更可靠支持。此外，还有几种自动化测试工具专门支持特定领域的测试类型，并具有快速高效地完成任务的功能。<br><img src="/image/selenium.jpg" alt="selenium"><br>如上图，很多QA或者tester有一个误区，提到自动化张嘴闭嘴都是selenium，甚至有的人连webdriver与selenium区别都不知道，所以这里我要澄清，ui自动化测试只是自动化测试中的一小部分，还包括api，接口，单元测试，集成测试，甚至性能测试我们都应该称为自动化测试。</p>
<p>网络与移动技术<br><img src="/image/webandmobile.jpeg" alt="webandmobile"></p>
<p>每个测试人员还必须熟悉web和mobile相关技术，以便他们能够更好了解应用程序的类型与架构，如何构建，以及相应的可扩展性，并为以后测试提供相应背景知识。这对于测试人员非常重要，因为它能够指导QA理解项目架构与所面临技术挑战，提供更有效的QA解决方案。<br>这里学问更多，完全是两大方向，知识领域都非常的广大，例如web端我们可能要测试不同浏览器兼容性，对于mobile来说，尤其是android这种版本碎片化以及各种自定义系统以及ui改更能会造成各种个样的问题，对于mobile我们甚至要考虑更多场景，例如app是否具有内存泄露，电量消耗的快慢，横竖屏的影响等等。不同构建工具，开发环境的区别等对于qa来说又要面对一堆未知领域，没事，继续加油。</p>
<p>SDLC 软件开发生命周期（Systems Development Life Cycle）<br><img src="/image/sdlc.jpeg" alt="sdlc"></p>
<p>测试人员也被建议学习软件生命周期管理技能，这将有助于QA更轻松了解应用程序开发任务和测试计划周期。对SDLC周期的深入了解还有助于预测应用程序的复杂性，从而提前采取正确的措施。因此，测试人员还必须学习适用于项目开发生命周期流程的几种开发方法，如瀑布，看板，Scrum，精益等。<br>作为一个qa,我们应关注软件开发生命周期中的每一步，了解敏捷开发迭代中的各个环节及时作出反馈，所以有时qa也需要承担scrum master的责任，例如某个story进度超过预定期限未完成，我们就应当了解原因，及时与团队成员以及客户沟通。</p>
<p>理性分析与逻辑思维<br><img src="/image/logic.jpeg" alt="sdlc"><br>为了保持竞争力，QA还应该学使用理性，分析性和逻辑性思维来思考问题，因为这些技能在测试应用时可以帮助QA识别错误，了解问题的复杂性，评估应用程序的不熟悉的功能并相应地进行测试。具有良好的分析和推理能力有助于根据在不同场景下验证应用程序，并根据预先定义的标准来评估应用程序。这进一步有助于评估相关信息，提出明确的问题，确定优势和弱点，而不会持有偏见，这有助于实施正确的行动方案和解决方案。</p>
<p>社交网络<br><img src="/image/contact.jpeg" alt="contact"><br>任何行业的任何专业人士都需要社交网络技能。由于社交网络可以即时访问讨论，资源和内容，因此在这方面的技巧有助于与其它QA进行互动，学习新事物并更新自己的知识体系的广度与深度。拥有社交网络技能还可让您与各种专家进行交流，交流疑问，当然也可以建立长期的合作关系，帮助您的专业技能和企业达到所需目标。</p>
<p>测试工具和技术<br><img src="/image/tools.jpg" alt="tools"><br>每个QA都必须了解不同的测试技术和使用工具。无论你的项目属于那个领域和应用程序类型，都应具有黑盒测试，渗透测试，安全测试，系统测试，单元测试等，测试人员具有多功能性，可以帮助他们在任何类型的项目上工作。此外，随着商业化的专业测试工具数量的增加，例如bug跟踪工具，测试管理工具，GUI测试工具，自动化工具等，测试人员可以了解这些工具的特点，选择适用于所在项目需求工具，以满足不同的需求和复杂性。</p>
<p>编程<br><img src="/image/coding.jpeg" alt="tools"></p>
<p>当我们谈论编程时，QA当然不会像开发人员一样工作，但是QA需要理解应用程序的实现原理与项目架构，这样我们可以更容易的创建所需的测试。编程知识有助于识别应用程序代码中的可能发生的错误，这就进一步降低了应用程序发生错误的概率。所以建议学习至少两种编程语言，这样的话测试人员就能够更好的了解应用程序的解决方案，以确保的应用程序生命周期的质量。</p>
<p>沟通 - 书面和口头<br><img src="/image/communicate.jpeg" alt="communicate"></p>
<p>每个QA还应具备良好的沟通能力。通过良好的沟通，对于项目的所有角色来说，QA应该是一个好的作家，演讲者，听众和读者，例如将项目的状态更新给客户，向团队通知story的需求变更，与开发人员交流bug的细节，将需求文档转化为测试用例，准备测试报告等。除此之外，良好的沟通有助于表现出个人高度的理解能力，进一步帮助QA在逻辑思维和理性分析基础上向技术人员和非技术人员提供反馈意见。</p>
<p>智力与创意<br>软件测试并不是一个程序化或平凡的任务，而是一个需要创造力和逻辑分析的过程。智力和创造力无法改变，但是，可以通过质疑应用程序行为并分析应用程序的不同方面来了解其工作原理。另外，通过设计一些应用场景，测试人员可以尝试探索性测试，来识别更多缺陷，并寻求提供有效产品质量的可能解决方案。</p>
<p>测试计划和文档</p>
<p>测试计划和文档对于每个QA至关重要，因为它有助于确定正确的需求以及采取合理的步骤。此外还可以帮助跟踪需求变化，检查测试过程和跟踪偏差，并有助于报告和记录工作。一个记录良好的测试过程也可以帮助个别测试者和企业将正确的预算和资源分配给一个项目，这就是为什么测试计划和文档技能是每个测试人员必须学习的重要技能之一。</p>
<p>项目管理<br>学习项目管理的技能，帮助QA提高对于处理问题的能力。例如项目中某个环节发生问题，通过项目管理技能，能够及时的分析问题影响广度，及时寻找相关人员协作处理问题，项目管理技能有助于QA了解项目流程中所存在的问题，来帮助更好改进整个测试过程。</p>
<p>客户支持<br><img src="/image/customers.jpeg" alt="customers"></p>
<p>与过去项目有所不同，现代测试项目要求QA提供客户支持并从他们的角度思考。作为QA并不意味着我只是关心功能是否正确，因为测试项目的成功或失败因素很多，而不仅仅只是局限于功能层面，因此QA应及时应对和支持客户提出的需求，并所他们角度思考哪些方面仍然需要改善。</p>
<p>报告<br><img src="/image/report.jpeg" alt="report"><br>优秀的QA必须拥有良好报告技能，才能向项目的成员与客户提供测试项目和被测试应用的确切状态。这种报告实践可以更好地协调整个测试项目，同时也为高层管理人员提供执行详细的数据，例如测试用例覆盖率，bug的数量，发布时间表等，最终有助于其做出正确的决策。</p>
<p>独立工作<br>最后，QA应该学习如何独立工作的技能。这将提高他们从需求理解（技术和业务需求）到产出的最终交付工作的能力，采取正确的步骤，在没有他人的帮助或经理的监督。学习独立工作将会增加对他们的信心。</p>
<p>无论经验多少，QA都应努力不断学习和提高软件测试技能和知识。无论是自学习还是参与培训计划，测试人员应不断学习新的方法，以提高测试工作中的效率，并继续应用新技能和学习，使自己处于领先地位。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/16/code-coverage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qi lei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QA seven's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/16/code-coverage/" itemprop="url">100% code coverage != 100% test</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-16T10:32:59+08:00">
                2017-02-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="100_25_code_coverage__21_3D_100_25_test"><a href="#100_25_code_coverage__21_3D_100_25_test" class="headerlink" title="100% code coverage != 100% test"></a>100% code coverage != 100% test</h1><h2 id="u5F15_u8A00"><a href="#u5F15_u8A00" class="headerlink" title="引言"></a>引言</h2><p><img src="http://upload-images.jianshu.io/upload_images/3732075-d1c1bc5652c294e5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="avatar"></p>
<p>很多人看到这个标题时，就在想你都100%代码覆盖了，怎么还会有问题呢？</p>
<p>让我们看看一下代码栗子：</p>
<p><strong>Code example</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCalculator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="typename">Double</span> add(<span class="typename">Double</span> a, <span class="typename">Double</span> b) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> a + b;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再让我们看看用junit写出的测试代码：</p>
<p>@Test</p>
<p>public void testAdd() {</p>
<p>Double a = new Double(1);</p>
<p>Double b = new Double(2);</p>
<p>Double c = new Double(3);</p>
<p>assertEquals(c, testCalculator.add(a, b));</p>
<p>}<br>当我们在Eclipse使用 EclEmme Code Coverage 插件测试时， 对于这个类我们将得到 100% Line-Coverage.<br><img src="http://upload-images.jianshu.io/upload_images/3732075-236eb1a30b91a0a1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="avatar"></p>
<p>一切看起来都那么的完美，真是这样的吗？</p>
<p>好吧，让我们来来看看另一个测试，当其中一个变量为null时，返回值将会怎样？</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> testAddNullPointerException() &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">Double</span> a = <span class="keyword">new</span> <span class="keyword">Double</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">Double</span> b = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">Double</span> c = <span class="keyword">new</span> <span class="keyword">Double</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">assertEquals(c, testCalculator.add(a, b));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>好了，你会发现尽管你的覆盖率为100%，但程序却抛出了NullPointerException异常。</p>
<p>对于很多PM来说会选择第一个测试代码,因为100%的单元测试覆盖率总比50%的测试代码要更好!</p>
<p>但是这有用么？我们可能忽略了更重要的业务场景测试。</p>
<p>哈哈，小小的嘲讽了部分PM。</p>
<p>我们应当转换下思维，思考以下问题。</p>
<p><strong>100%的覆盖率并不意味你的测试代码质量很高，上面那个列子就是典型。</strong></p>
<p><strong>100%的覆盖率并不意味着所有的业务场景都被覆盖。</strong></p>
<p><strong>对于项目我们是否有足够的测试？</strong><br><img src="http://upload-images.jianshu.io/upload_images/3732075-b6a0abab1778f170.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="avatar"></p>
<p>这里的测试不仅仅包括代码级别的单元测试，还要集成测试，接口测试，黑盒测试，可用性测试等等。只有全部得测试通过后，才能说明功能的完整性，仅仅单一的单元测试，对于整个项目来说，基本没用。</p>
<p><strong>所以100%的代码覆盖率值得追求吗?</strong><br><img src="http://upload-images.jianshu.io/upload_images/3732075-80f3e850430d8615.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="avatar"></p>
<p>  是的，这应该是每个程序猿毕生追求的之一，但是如果从项目角度考虑，ROI(投入产出比)，如果你的项目是一个短期项目，需要快速上线，那么这时候你需要注重的是测试应覆盖核心功能代码。如果你的项目是一个长期项目，那么高覆盖率是非要有必要的，它意味着可维护性，以及更少的bug。(前提是你的测试采用TDD/BDD方式编写，我见过将测试代码写的一团糟的人，看着他的代码，我宁愿重新一遍)</p>
<p><strong>那么对于一个项目来说覆盖率应该达到多少？</strong></p>
<p>  其实没有具体数值能够覆盖到所有的项目，每个项目都应有自己的阈值，但共性是，必须测试必须覆盖主要业务场景，代码的逻辑分支也必须覆盖。</p>
<p><strong>如何改进你的项目代码覆盖率？</strong></p>
<p>  阅读和理解项目代码，找出其中需要测试并且与业务强相关的代码。</p>
<p>  将之前可读性差测试代码，采用TDD与BDD方式进行重写，提高项目的可维护性与可读性。</p>
<p><strong>代码覆盖率非常重要的意义在于：</strong></p>
<p>  分析未覆盖部分的代码，从而反推在前期黑盒测试设计是否充分，没有覆盖到的代码是否是测试设计的盲点，为什么没有考虑到？是需求/设计不够清晰，还是测试设计的理解有误。</p>
<p>  检测出程序中的废代码，可以逆向反推在代码设计中不合理的地方，提醒设计/开发人员理清代码逻辑关系，提升代码质量。</p>
<p>  代码覆盖率高不能说明代码质量高，但是反过来看，代码覆盖率低，代码质量绝对不会高到哪里去，可以作为测试自我审视的重要工具之一。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/25/espresso4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qi lei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QA seven's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/25/espresso4/" itemprop="url">espresso-api之Matchers探究</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-25T21:00:09+08:00">
                2016-12-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>通过前3篇文章，大家应该对espresso有了大体上的了解，那么今天我们要深入了解它的API，看看espresso的整体架构。<br>还是通过espresso cheat sheet来进入本次话题。</p>
<p><img src="/image/espresso-cheat-sheet-2.1.0.png" alt=""></p>
<p>Espresso备忘单是您在开发过程中可以使用的快速参考。 这个备忘单包含大多数可用的Matchers，ViewActions和ViewAsertions。<br>让我们先来看看Matchers 都有哪些API可供我们使用。<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">android<span class="class">.support</span><span class="class">.test</span><span class="class">.espresso</span><span class="class">.matcher</span></span><br><span class="line">Classes</span><br><span class="line">BoundedMatcher&lt;T, S extends T&gt;	Some matcher sugar that lets you create <span class="tag">a</span> matcher <span class="keyword">for</span> <span class="tag">a</span> given type but only process items of <span class="tag">a</span> specific subtype of that matcher.</span><br><span class="line">CursorMatchers	A collection of Hamcrest matchers that matches <span class="tag">a</span> data row <span class="keyword">in</span> <span class="tag">a</span> Cursor.</span><br><span class="line">CursorMatchers<span class="class">.CursorMatcher</span>	A Matcher that matches Cursors based on values <span class="keyword">in</span> their <span class="attribute">columns</span>.</span><br><span class="line">LayoutMatchers	A collection of hamcrest matches to detect typical layout issues.</span><br><span class="line">PreferenceMatchers	A collection of hamcrest matchers that match Preferences.</span><br><span class="line">RootMatchers	A collection of matchers <span class="keyword">for</span> Root objects.</span><br><span class="line">ViewMatchers	A collection of hamcrest matchers that match Views.</span><br><span class="line">Enums</span><br><span class="line">ViewMatchers<span class="class">.Visibility</span>	Enumerates the possible list of values <span class="keyword">for</span> View.<span class="function"><span class="title">getVisibility</span><span class="params">()</span></span>.</span><br></pre></td></tr></table></figure></p>
<p>7个类，1个Eums。接下来我们一个个欣赏谷歌大神的杰作。</p>
<p><code>BoundedMatcher&lt;T, S extends T&gt;</code><br>一些匹配语法糖，允许您为给定类型创建匹配器，但只能处理该匹配器的特定子类型项。换句话说，就是能够自定义一些匹配器。<br>举个栗子，以下是一个自定义错误文本匹配器<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorTextMatchers</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * Returns a matcher that matches &#123;<span class="doctag">@link</span> TextView&#125;s based on text property value.</span><br><span class="line">   *</span><br><span class="line">   * <span class="doctag">@param</span> stringMatcher &#123;<span class="doctag">@link</span> Matcher&#125; of &#123;<span class="doctag">@link</span> String&#125; with text to match</span><br><span class="line">   */</span></span><br><span class="line">  <span class="annotation">@NonNull</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Matcher&lt;View&gt; <span class="title">withErrorText</span><span class="params">(<span class="keyword">final</span> Matcher&lt;String&gt; stringMatcher)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> BoundedMatcher&lt;View, TextView&gt;(TextView.class) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="annotation">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">describeTo</span><span class="params">(<span class="keyword">final</span> Description description)</span> </span>&#123;</span><br><span class="line">        description.appendText(<span class="string">"with error text: "</span>);</span><br><span class="line">        stringMatcher.describeTo(description);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="annotation">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matchesSafely</span><span class="params">(<span class="keyword">final</span> TextView textView)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stringMatcher.matches(textView.getError().toString());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>实现的主要细节如下。 我们通过从withErrorText()返回一个BoundedMatcher来确保匹配器只匹配TextView类的子类。 这使得很容易在BoundedMatcher.matchesSafely()中实现匹配逻辑本身：只需从TextView中获取getError()方法并将其送入下一个匹配器。 最后，我们有一个简单的describeTo()方法的实现，它只用于生成调试输出到控制台。<br><code>CursorMatchers</code><br>Hamcrest的集合匹配器，在Cursor匹配相应的数据行。<br>源码如下<br><figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">   * Returns a matcher that matches <span class="name">a</span> &#123;@<span class="literal">link</span> String&#125; <span class="name">value</span> <span class="name">at</span> <span class="name">a</span> <span class="name">given</span> <span class="name">column</span> <span class="name">index</span></span><br><span class="line">   * in <span class="name">a</span> &#123;@<span class="literal">link</span> Cursor&#125;<span class="name">s</span> <span class="name">data</span> <span class="name">row</span>.</span><br><span class="line">   * &lt;br&gt;</span><br><span class="line">   * @param columnIndex int column index</span><br><span class="line">   * @param value <span class="name">a</span> &#123;@<span class="literal">link</span> String&#125; <span class="name">value</span> <span class="name">to</span> <span class="name">match</span></span><br><span class="line">   */</span><br><span class="line">  public static CursorMatcher withRowString(int columnIndex, String value) &#123;</span><br><span class="line">    return withRowString(columnIndex, is(value));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>大部分的场景，大多发生于表单或者滚动menu时。<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">onData<span class="list">(</span><br><span class="line">    <span class="keyword">is</span><span class="list">(<span class="keyword">instanceOf</span><span class="list">(<span class="keyword">Cursor</span>.class)</span>)</span>,</span><br><span class="line">    CursorMatchers.withRowString<span class="list">(<span class="string">"job_title"</span>, is<span class="list">(<span class="string">"Barista"</span>)</span>)</span></span><br><span class="line">)</span><span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>LayoutMatchers hamcrest的集合匹配以检测典型的布局问题。<br>   例如匹配具有椭圆形文本的TextView元素。 如果文本太长，无法适应TextView，<br>    它可以是椭圆形（’Too long’显示为’Too l …’或’… long’）或切断（’Too<br>    long“显示为”Too l“）。 虽然在某些情况下可以接受，但通常表示不好的用户体验。</p>
<p>PreferenceMatchers hamcrest匹配器来匹配一组偏好。<br>Preference组件其实就是Android常见UI组件与SharePreferences的组合封装实现。<br><code>onData(Matchers.&lt;Object&gt;allOf(PreferenceMatchers.withKey(&quot;setting-name&quot;))).perform(click());</code><br>PreferenceMatchers还有以下方法可以应用到其他场景<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">withSummary</span><span class="params">(final int resourceId)</span></span></span><br><span class="line"><span class="function"><span class="title">withSummaryText</span><span class="params">(String summary)</span></span></span><br><span class="line"><span class="function"><span class="title">withSummaryText</span><span class="params">(final Matcher&lt;String&gt; summaryMatcher)</span></span></span><br><span class="line"><span class="function"><span class="title">withTitle</span><span class="params">(final int resourceId)</span></span></span><br><span class="line"><span class="function"><span class="title">withTitleText</span><span class="params">(String title)</span></span></span><br><span class="line"><span class="function"><span class="title">withTitleText</span><span class="params">(final Matcher&lt;String&gt; titleMatcher)</span></span></span><br><span class="line"><span class="function"><span class="title">isEnabled</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></p>
<p>RootMatchers Root对象的匹配器集合。<br>匹配root装饰视图匹配给定的视图匹配器。<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">onView</span>(<span class="function">withText</span>("<span class="value">Text</span>"))</span><br><span class="line">  <span class="class">.inRoot</span>(<span class="function">withDecorView</span>(<span class="function">not</span>(<span class="function">is</span>(<span class="function">getActivity</span>()<span class="class">.getWindow</span>()<span class="class">.getDecorView</span>()))))</span><br><span class="line">  <span class="class">.perform</span>(<span class="function">click</span>());</span><br></pre></td></tr></table></figure></p>
<p>RootMatchers还有以下方法可以应用到其他场景</p>
<table>
<thead>
<tr>
<th>Public methods</th>
</tr>
</thead>
<tbody>
<tr>
<td>static Matcher<root></root></td>
<td>isDialog()Matches Roots that are dialogs (i.e.)</td>
</tr>
<tr>
<td>static Matcher<root></root></td>
<td>isFocusable()Matches Roots that can take window focus.</td>
</tr>
<tr>
<td>  static Matcher<root></root></td>
<td>isPlatformPopup()Matches Roots that are popups - like autocomplete suggestions or the actionbar spinner.  </td>
</tr>
<tr>
<td>  static Matcher<root></root></td>
<td>isTouchable()Matches Roots that can receive touch events.  </td>
</tr>
<tr>
<td>  static Matcher<root></root></td>
<td>withDecorView(Matcher<view> decorViewMatcher)Matches Roots with decor views that match the given view matcher.</view></td>
</tr>
</tbody>
</table>
<p>  ViewMatchers 最重要也是应用最广的匹配器，通过一个或者多个来定位层级里面的控件。</p>
<table>
<thead>
<tr>
<th>Public methods</th>
</tr>
</thead>
<tbody>
<tr>
<td>  static <t> void</t></td>
<td>assertThat(String message, T actual, Matcher<t> matcher) A replacement for MatcherAssert.assertThat that renders View objects nicely.</t></td>
</tr>
<tr>
<td>  static <t> void</t></td>
<td>assertThat(T actual, Matcher<t> matcher) A replacement for MatcherAssert.assertThat that renders View objects nicely.</t></td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>hasContentDescription() Returns an Matcher that matches Views with any content description.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>hasDescendant(Matcher<view> descendantMatcher) Returns a matcher that matches Views based on the presence of a descendant in its view hierarchy.</view></td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>hasErrorText(String expectedError) Returns a matcher that matches EditText based on edit text error string value.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>hasErrorText(Matcher<string> stringMatcher) Returns a matcher that matches EditText based on edit text error string value.</string></td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>hasFocus() Returns a matcher that matches Views currently have focus.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>hasImeAction(int imeAction) Returns a matcher that matches views that support input methods (e.g.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>hasImeAction(Matcher<integer> imeActionMatcher) Returns a matcher that matches views that support input methods (e.g.</integer></td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>hasLinks() Returns a matcher that matches TextViews that have links.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>hasSibling(Matcher<view> siblingMatcher) Returns an Matcher that matches Views based on their siblings.</view></td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>isAssignableFrom(Class&lt;? extends View&gt; clazz) Returns a matcher that matches Views which are an instance of or subclass of the provided class.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>isChecked() Returns a matcher that accepts if and only if the view is a CompoundButton (or subtype of) and is in checked state.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>isClickable() Returns a matcher that matches Views that are clickable.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>isCompletelyDisplayed() Returns a matcher which only accepts a view whose height and width fit perfectly within the currently displayed region of this view.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>isDescendantOfA(Matcher<view> ancestorMatcher) Returns a matcher that matches Views based on the given ancestor type.</view></td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>isDisplayed() Returns a matcher that matches Views that are currently displayed on the screen to the user.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>isDisplayingAtLeast(int areaPercentage) Returns a matcher which accepts a view so long as a given percentage of that view’s area is not obscured by any other view and is thus visible to the user.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>isEnabled() Returns a matcher that matches Views that are enabled.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>isFocusable() Returns a matcher that matches Views that are focusable.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>isJavascriptEnabled() Returns a matcher that matches WebView if they are evaluating Javascript.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>isNotChecked() Returns a matcher that accepts if and only if the view is a CompoundButton (or subtype of) and is not in checked state.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>isRoot() Returns a matcher that matches root View.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>isSelected() Returns a matcher that matches Views that are selected.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>supportsInputMethods() Returns a matcher that matches views that support input methods.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withChild(Matcher<view> childMatcher) A matcher that returns true if and only if the view’s child is accepted by the provided matcher.</view></td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withClassName(Matcher<string> classNameMatcher) Returns a matcher that matches Views with class name matching the given matcher.</string></td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withContentDescription(int resourceId) Returns a Matcher that matches Views based on content description property value.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withContentDescription(String text) Returns an Matcher that matches Views based on content description property value.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withContentDescription(Matcher&lt;? extends CharSequence&gt; charSequenceMatcher) Returns an Matcher that matches Views based on content description property value.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withEffectiveVisibility(ViewMatchers.Visibility visibility) Returns a matcher that matches Views that have “effective” visibility set to the given value.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withHint(Matcher<string> stringMatcher) Returns a matcher that matches TextViews based on hint property value.</string></td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withHint(int resourceId) Returns a matcher that matches a descendant of TextView that is displaying the hint associated with the given resource id.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withHint(String hintText) Returns a matcher that matches TextView based on it’s hint property value.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withId(Matcher<integer> integerMatcher) Returns a matcher that matches Views based on resource ids.</integer></td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withId(int id) Same as withId(is(int)), but attempts to look up resource name of the given id and use an R.id.myView style description with describeTo.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withInputType(int inputType) Returns a matcher that matches InputType.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withParent(Matcher<view> parentMatcher) A matcher that accepts a view if and only if the view’s parent is accepted by the provided matcher.</view></td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withResourceName(String name) Returns a matcher that matches Views based on resource id names, (for instance, channel_avatar).</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withResourceName(Matcher<string> stringMatcher) Returns a matcher that matches Views based on resource id names, (for instance, channel_avatar).</string></td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withSpinnerText(int resourceId) Returns a matcher that matches a descendant of Spinner that is displaying the string of the selected item associated with the given resource id.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withSpinnerText(String text) Returns a matcher that matches Spinner based on it’s selected item’s toString value.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withSpinnerText(Matcher<string> stringMatcher) Returns a matcher that matches Spinners based on toString value of the selected item.</string></td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withTagKey(int key) Returns a matcher that matches View based on tag keys.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withTagKey(int key, Matcher<object> objectMatcher) Returns a matcher that matches Views based on tag keys.</object></td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withTagValue(Matcher<object> tagValueMatcher) Returns a matcher that matches Views based on tag property values.</object></td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withText(Matcher<string> stringMatcher) Returns a matcher that matches TextViews based on text property value.</string></td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withText(String text) Returns a matcher that matches TextView based on its text property value.</td>
</tr>
<tr>
<td>  static Matcher<view></view></td>
<td>withText(int resourceId) Returns a matcher that matches a descendant of TextView that is displaying the string associated with the given resource id.</td>
</tr>
</tbody>
</table>
<p>ok 这次主要介绍Matchers的API 更多的内容 大家还是要查看官方API去学习。<br>以下是android espresso matchers的地址<br><a href="https://developer.android.com/reference/android/support/test/espresso/matcher/ViewMatchers.html" target="_blank" rel="external">espresso matchers</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/13/qa-heart/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qi lei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QA seven's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/13/qa-heart/" itemprop="url">QA请勿忘初心</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-13T21:42:54+08:00">
                2016-12-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="u9996_u5148_u8BA9_u6211_u4EEC_u56DE_u987E_u4E00_u4E0BQA_u4E0EQC_u7684_u533A_u522B_uFF1A"><a href="#u9996_u5148_u8BA9_u6211_u4EEC_u56DE_u987E_u4E00_u4E0BQA_u4E0EQC_u7684_u533A_u522B_uFF1A" class="headerlink" title="首先让我们回顾一下QA与QC的区别："></a>首先让我们回顾一下QA与QC的区别：</h2><p><strong>Quality Assurance</strong> :The planned and systematic activities implemented in a quality system so that quality requirements for a product or service will be fulfilled.<br><strong>Quality Control</strong> :The observation techniques and activities used to fulfill requirements for quality.</p>
<p>QA的工作涉及软件研发流程的各个环节，且涉及到每一位参与研发的人员，但质量保证工作又不涉及具体的软件研发细节，侧重于整个流程。</p>
<p>QC则侧重于点，利用各种方法去检查某个功能是否满足业务需求。</p>
<p>thoughtworks 的QA则是这两者的混合体，你既要保证开发流程的质量，又要保证story的功能的是否正确。</p>
<hr>
<p>来thoughtworks已经2年了，当过bqconf讲师与主持，参加过公司内各类测试相关活动，也阅读过g邮件中分享的关于test的话题，大部分人关注点都离不开自动化测试，面试的QA也说想到thoughtworks来学习高深的自动化测试，仿佛自动化测试代表了整个QA界，我反对盲目的自动化测试，确切的说反对盲目的UI自动化测试。很多QA在自动化测试海洋里迷失了自己。<br>我要强调自动化测试: 真的没有银弹。</p>
<p><img src="/image/QA_TW.jpg" alt=""></p>
<h2 id="QA_u7684_u6700_u7EC8_u4EF7_u503C_u4F53_u73B0"><a href="#QA_u7684_u6700_u7EC8_u4EF7_u503C_u4F53_u73B0" class="headerlink" title="QA的最终价值体现"></a>QA的最终价值体现</h2><p><strong>Faster Delivery Of Quality Software From Idea To Consumer</strong></p>
<h3 id="u786E_u4FDD_u9879_u76EE_u7684_u6B63_u786E_u6027"><a href="#u786E_u4FDD_u9879_u76EE_u7684_u6B63_u786E_u6027" class="headerlink" title="确保项目的正确性"></a>确保项目的正确性</h3><p>所以自动化测试只是其中的一小部分。<br>如上图顶部和底部的文字是对一个QA所能带给项目的总结：“我们在开发正确的产品吗？如果是，那么我们开发的产品正确吗？”所以QA首先需要在整个个项目过程中不断询问的所有成员上述问题，确保团队是在开发客户所需的产品，而不是自己YY出来的产品。</p>
<h3 id="u786E_u4FDD_u6D41_u7A0B_u7684_u6B63_u786E_u6027"><a href="#u786E_u4FDD_u6D41_u7A0B_u7684_u6B63_u786E_u6027" class="headerlink" title="确保流程的正确性"></a>确保流程的正确性</h3><p><strong>Quality is not just in the software but also in the process</strong></p>
<p>质量从来都不只是QA的职责，而是整个团队的职责。但QA如果自己都不注重，不督促组内成员改进质量，再将责任强加于整个团队，那么产品质量又何谈提升与保证。<br>中间的图片从一个QA的角度表明了一个用户故事的生命周期以及QA如何参与其中每个环节。</p>
<p><img src="/image/pair_with_BA.png" alt=""><br>首先BA和客户将要开发的story列出之后，BA与QA可以一起pair编写具体story的内容，场景与验收条件,利用自己对业务以及系统的熟悉度，尽量的配合BA将story中坑尽量排除掉。</p>
<p><img src="/image/kick_off.png" alt=""><br>所有参与kick off 角色，都应该提前了解story内容。在kick off过程中，提出自己对story疑问。尽量将业务需求上问题在这个阶段解决。<br><img src="/image/pair_with_dev.png" alt=""><br>在完成kick off后，QA可以和dev一起pair完成编写unit test 以及Automated Acceptance Tests，身为一个敏捷QA，我们起码要了解团队选用的单元测试工具，熟悉项目的技术架构，这样更好的便于我们对整个项目质量把控，在与dev pair的过程中，即帮助dev分析业务场景的分支，来确保单元测试覆盖的是正确的场景，而不是为了交代上级随便乱写的单元测试，也帮助QA熟悉代码，提高编码能力。<br><img src="/image/sign_off.png" alt=""><br>当DEV完成编码工作后，这时QA UX BA DEV一起检查story，是否按照story AC来检查是否完成对应的功能。UX也可发表对story UI以及交互一些看法，有任何问题及时讨论后，将问题尽早的反馈给客户。<br><img src="/image/test_test.png" alt=""><br>当开发交付一部分功能之后，QA就可以做常规的用户故事测试，几个迭代之后，QA开始进行跨功能需求测试和探索性测试等。根据探索性测试的结果，QA可能会调整测试策略，调整测试优先级，完善测试用例等等。<br><img src="/image/report.png" alt=""><br>上面这些QA实践貌似已经很完美,其实还差最重要的一环 <strong>quality analysis</strong> 。每次release后，我们总以为我们发布一个完美的产品，但却总能在新迭代开发过程中发现之前问题，历史总是惊人的相似，为什么，没有分析总结问题，以及相应的预防手段,那么同样的问题只会重现。<br>同时我们也要回顾下自己在工作中真的将这些敏捷实践都应用到工作中吗，我想或多或少的都有所欠缺。对于一个QA来说，不应循规蹈矩照搬敏捷实践。例如，在kickoff中，发现dev，UX对story涉及的场景以及内容了解不清楚，QA也可能漏掉一些测试场景，那么我们可以在kickoff之前，加入一个pre- kick off的实践，留出时间，让每个角色都能够完整了解story。在kick off之中，ux没有办法完整的确认页面的字体大小或者颜色等是否正确，那么在sign off之后，我们也加入一个UX-test实践，帮助UX能够更好解决这些问题。<br>所以每个项目也都有应适合自己项目的敏捷实践，发现项目存在的问题，持续改进才是最佳实践。</p>
<h2 id="u518D_u6765_u8C08_u8C08_u81EA_u52A8_u5316_u6D4B_u8BD5_u5427_u3002"><a href="#u518D_u6765_u8C08_u8C08_u81EA_u52A8_u5316_u6D4B_u8BD5_u5427_u3002" class="headerlink" title="再来谈谈自动化测试吧。"></a>再来谈谈自动化测试吧。</h2><p><img src="/image/pyramid.png" alt="pyramid"><br>上面的测试金字塔对于大家来说再熟悉不过了，对于自动化测试来说最有价值的仍然是单元测试，但对于QA来说无疑最复杂的。<br>大部分QA或者tester，仍然以UI自动化为重心。之所以反对盲目的UI自动化测试，因为变化频繁的UI设计，极低投入产生比，都应该让我们重新思考下UI自动化的价值。</p>
<h3 id="u6211_u4EEC_u9700_u8981_u4E00_u4E2A_u5B9E_u65BDUI_u81EA_u52A8_u5316_u6B63_u786E_u7684_u65B9_u5F0F_uFF1A"><a href="#u6211_u4EEC_u9700_u8981_u4E00_u4E2A_u5B9E_u65BDUI_u81EA_u52A8_u5316_u6B63_u786E_u7684_u65B9_u5F0F_uFF1A" class="headerlink" title="我们需要一个实施UI自动化正确的方式："></a>我们需要一个实施UI自动化正确的方式：</h3><ul>
<li>能不用UI自动化测试就不用，梳理业务主线，只保留用户操作最频繁，交互最多的场景。</li>
<li>根据面向对象设计的原则，构建适合项目的UI自动化框架，无论自己编写框架，还是采用开源框架。</li>
<li>尽量采用独立测试数据，确保运行测试不受影响。例如采用mock数据库或者每次运行时还原测试数据库。<h3 id="u56DE_u5230_u6B63_u9898_uFF0C_u9762_u5BF9_u81EA_u52A8_u5316_u6D4B_u8BD5_u7684_u5927_u6F6E_uFF0CQA_u5E94_u8BE5_u5173_u6CE8_u4EC0_u4E48_uFF1F"><a href="#u56DE_u5230_u6B63_u9898_uFF0C_u9762_u5BF9_u81EA_u52A8_u5316_u6D4B_u8BD5_u7684_u5927_u6F6E_uFF0CQA_u5E94_u8BE5_u5173_u6CE8_u4EC0_u4E48_uFF1F" class="headerlink" title="回到正题，面对自动化测试的大潮，QA应该关注什么？"></a>回到正题，面对自动化测试的大潮，QA应该关注什么？</h3></li>
<li>编码规范，真实例子，dev对于类名命名没有用Camel-Case，造成在linux系统中部署不成功，python中乱使用缩进等。 其实都可以避免到，例如开发工具加入自动检查，或者在CI上加入校验编码规范的步骤，采用一些工具就可以达到目的，jshint，RuboCop等。</li>
<li>pair完成单元测试或API测试等，一方面可以提高QA的编码能力，另一面可以给出dev一些建议，将单元测试覆盖到更多的场景。<br>例如，如果你们项目采用react作为前端框架，如果你不能理解react virtual dom 与jsx，当我们在写UI自动化脚本时，你会发现根本无法进行下去，日常中我们定位元素全是这种<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"styles__formField___1fyGy"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">placeholder</span>=<span class="value">"Email"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">svg</span> <span class="attribute">class</span>=<span class="value">"styles__formIcon___37VGd"</span> <span class="attribute">viewBox</span>=<span class="value">"0 0 24 24"</span> <span class="attribute">style</span>=<span class="value">"display: inline-block; fill: rgba(0, 0, 0, 0.870588); height: 24px; width: 24px; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">path</span> <span class="attribute">d</span>=<span class="value">"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>,所有的页面都是js渲染出来的，如果你懂jsx，就知道只需要在对于的Component render方法中更改加入id等元素就可以搞定<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line"><span class="command">    return</span> (</span><br><span class="line">        &lt;<span class="keyword">div</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> placeholder=<span class="string">"Email"</span> <span class="property">id</span>=<span class="string">"Email"</span>&gt;</span><br><span class="line">        &lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>控制单元测试覆盖率，100%的单元测试覆盖率当然是最好的，但如果交付压力大，和客户商量后，我们可以尽量覆盖业务主线，而不是为了达到覆盖率延误了交付周期。</li>
</ul>
<h2 id="u518D_u6765_u8C08_u8C08_u8D28_u91CF_u5206_u6790_u3002"><a href="#u518D_u6765_u8C08_u8C08_u8D28_u91CF_u5206_u6790_u3002" class="headerlink" title="再来谈谈质量分析。"></a>再来谈谈质量分析。</h2><p>作为一个QA，我们不仅要检测项目中存在问题，也要改进团队的实践活动，更重要的是预防问题的发生。</p>
<ul>
<li>每次bugbash或相应迭代完成后，要分析统计，找出产生缺陷的环节，并采取措施防止问题再现。例如每次release或者bug bash之后,我可以按照功能模块与bug类型进行统计划分，分析统计bug的成因，例如某次迭代我们bug数量激增，经调查，发现我们对某些模块的前端代码进行了重构，但缺乏相应的单元测试与集成测试，造成了我们没有及时发现bug。之后我们就对应的采取措施防止问题再现。</li>
<li>总结分析报告，及时反馈这些信息给团队。总结分析是一个长期的任务，每次bug数量的变动，都会直接体现整个团队上次迭代的开发质量，例如bug数量减少了，可以鼓励成员再接再厉。或者某几次迭代某些模块bug成上升趋势，那么就需要组织团队一起讨论问题根源，采取措施防止问题重现。</li>
<li>利用代码质量分析工具帮助我们尽早预防问题的发生。例如sonar代码质量管理平台，可以帮助我们从代码复杂度，重复代码，单元测试覆盖率，编码规范等纬度来分析我们代码所存在的问题。当然也有其他的开源工具，像RubyCritic，/plato不同的语言都会有相应的工具。</li>
<li>在线监控，利用像newrelic，airbnb等监控工具对部署在本地或在云中的web应用程序进行监控、故障修复、诊断、线程分析以及容量计划。这样就算们产品环境有任何问题，我们都会及时响应，尽早修复，减低损失。</li>
</ul>
<h2 id="u6700_u540E_u8BA9_u6211_u4EEC_u5728_u770B_u770BQA_u5E94_u5177_u6709_u90A3_u4E9B_u80FD_u529B_u4E0E_u6280_u80FD"><a href="#u6700_u540E_u8BA9_u6211_u4EEC_u5728_u770B_u770BQA_u5E94_u5177_u6709_u90A3_u4E9B_u80FD_u529B_u4E0E_u6280_u80FD" class="headerlink" title="最后让我们在看看QA应具有那些能力与技能."></a>最后让我们在看看QA应具有那些能力与技能.</h2><p><img src="/image/qa_capablities.png" alt="qa_capablities"><br><img src="/image/qa_skills.png" alt="qa_skills"></p>
<p>软技能方面包括风险控制，辅导他人，沟通能力，分析定位等。技能方面则包括缺陷管理，流程改进，测试分析，可用性测试，性能测试，安全测试等。</p>
<h2 id="u5199_u5728_u6700_u540E"><a href="#u5199_u5728_u6700_u540E" class="headerlink" title="写在最后"></a>写在最后</h2><p>回顾上面这些实践，其实我们可以做的更好，而不是把团队的质量全都交给自动化，回归QA的应有的初心，让我们从各个方面改进质量，带给团队更好的未来。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/08/espresso3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qi lei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QA seven's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/08/espresso3/" itemprop="url">espresso系列3--测试实践</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-08T22:30:17+08:00">
                2016-12-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="前言"></a>前言</h2><p>前2篇我们已经详细介绍了espresso的架构以及相应的API，相信大家也有了一定的了解，理论讲的再多，还是不如手上自己敲一遍代码。<br>还是深入浅出系列的套路，让我这个小司机带大家一步一步进入espresso的世界吧。</p>
<h2 id="u73AF_u5883_u51C6_u5907"><a href="#u73AF_u5883_u51C6_u5907" class="headerlink" title="环境准备"></a>环境准备</h2><p><img src="http://f.hiphotos.baidu.com/baike/c0%3Dbaike80%2C5%2C5%2C80%2C26/sign=1b0dc3d30d2442a7ba03f5f7b02ac62e/6159252dd42a2834b1c7cf5b59b5c9ea15cebf79.jpg" alt="github"><br>github，如果你还用svn的话，请放弃阅读本系列文章，太low了，而且本系列的code都是采用google官方的espresso的demo，都来源于github。<br><img src="http://web.img.chuanke.com/course/2015-03/04/208e43b22dffd2a46a88f2a610c77e35.jpg" alt="android studio"><br>android studio,这个不用说，目前android开发者最好的工具，并且他有很多帮助espresso测试的插件或功能，比如录制功能等。<br><img src="http://i1.wp.com/photo.sofun.tw/2013/09/Android-SDK-ADT-Bundle-Logo.jpg" alt="android sdk"><br>android sdk，这个更不用说，如果你连这个都没，还学什么android。<br><img src="http://img1.imgtn.bdimg.com/it/u=2429262149,756671414&amp;fm=21&amp;gp=0.jpg" alt="genymotion"><br>genymotion,android目前来说最好的模拟器，虽然原生的也很不错，但是开发者首先得还是genymotion</p>
<h3 id="u9996_u5148_u4F7F_u7528android_studio_u521B_u5EFA_u9879_u76EE"><a href="#u9996_u5148_u4F7F_u7528android_studio_u521B_u5EFA_u9879_u76EE" class="headerlink" title="首先使用android studio创建项目"></a>首先使用android studio创建项目</h3><p>最好你已经拥有了项目源码，espresso并不是单纯的黑盒ui测试工具，它能干得事情很多，包括单元测试，集成测试，甚至在mock服务，以及将你需要的内容注入到代码中，所以我把称为灰盒工具。<br>如果之前没有做个android项目的话，也可以在github上找一些开源的android app 练手。不过建议大家从espresso demo库入手。</p>
<h4 id="u521B_u5EFA_u9879_u76EE"><a href="#u521B_u5EFA_u9879_u76EE" class="headerlink" title="创建项目"></a>创建项目</h4><p><img src="/image/android_studio.png" alt="android_studio"></p>
<p>如上图，我们可以创建新的项目，导入已经存在android项目，从版本管理软件中导入，从gradle等其他工具中导入，以及获取android代码样例导入。<br>google android 所有的测试demo都在以下github地址<br><a href="https://github.com/googlesamples/android-testing.git" target="_blank" rel="external">    https://github.com/googlesamples/android-testing.git</a><br>下载完成后，我们进入espresso目录，可以看到espresso的demo还是很丰富的。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># lqi @ CNlqi-<span class="number">3</span> in ~/work/test/android/android-testing on git:master x [<span class="number">0</span>:<span class="number">19</span>:<span class="number">24</span>]</span></span><br><span class="line">$ cd ui/espresso</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># lqi @ CNlqi-<span class="number">3</span> in ~/work/test/android/android-testing/ui/espresso on git:master x [<span class="number">0</span>:<span class="number">19</span>:<span class="number">31</span>]</span></span><br><span class="line">$ ls</span><br><span class="line">BasicSample           CustomMatcherSample   EspressoSpoonDemo     IntentsAdvancedSample MultiWindowSample     WebBasicSample</span><br><span class="line">BasicSampleBundled    DataAdapterSample     IdlingResourceSample  IntentsBasicSample    RecyclerViewSample    spoon-gradle-plugin</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># lqi @ CNlqi-<span class="number">3</span> in ~/work/test/android/android-testing/ui/espresso on git:master x [<span class="number">0</span>:<span class="number">19</span>:<span class="number">37</span>]</span></span><br><span class="line">$ cd BasicSample</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># lqi @ CNlqi-<span class="number">3</span> in ~/work/test/android/android-testing/ui/espresso/BasicSample on git:master x [<span class="number">0</span>:<span class="number">19</span>:<span class="number">40</span>]</span></span><br><span class="line">$ pwd</span><br><span class="line">/Users/lqi/work/test/android/android-testing/ui/espresso/BasicSample</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># lqi @ CNlqi-<span class="number">3</span> in ~/work/test/android/android-testing/ui/espresso/BasicSample on git:master x [<span class="number">0</span>:<span class="number">20</span>:<span class="number">42</span>]</span></span><br><span class="line">$</span><br></pre></td></tr></table></figure></p>
<h4 id="u5BFC_u5165_u9879_u76EE"><a href="#u5BFC_u5165_u9879_u76EE" class="headerlink" title="导入项目"></a>导入项目</h4><p>选择<code>BasicSample</code>导入或者直接命令行<code>studio .</code>打开该项目。<br><img src="/image/android_menu.png" alt="android_menu">·<br>外层的build.gradle文件设置的是整个项目的一些配置,例如依赖的类库，远程的仓库repositories。编译器的版本，espresso的版本等。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">buildscript</span> &#123;</span><br><span class="line">    <span class="keyword">repositories</span> &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">dependencies</span> &#123;</span><br><span class="line">        <span class="keyword">classpath</span> <span class="string">'com.android.tools.build:gradle:2.1.2'</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// <span class="doctag">NOTE:</span> Do not place your application dependencies here; they belong</span></span><br><span class="line">        <span class="comment">// in the individual module build.gradle files</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">allprojects</span> &#123;</span><br><span class="line">    <span class="keyword">repositories</span> &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ext &#123;</span><br><span class="line">    buildToolsVersion = <span class="string">"24.0.1"</span></span><br><span class="line">    supportLibVersion = <span class="string">"24.2.0"</span></span><br><span class="line">    runnerVersion = <span class="string">"0.5"</span></span><br><span class="line">    rulesVersion = <span class="string">"0.5"</span></span><br><span class="line">    espressoVersion = <span class="string">"2.2.2"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="u76EE_u5F55_u7ED3_u6784"><a href="#u76EE_u5F55_u7ED3_u6784" class="headerlink" title="目录结构"></a>目录结构</h4><p>app目录为项目主目录包含项目源代码以及测试代码<br>app里面也包含build.gradle文件，有时候项目可能包含几个主目录，那么各个目录的下的build.gradle文件都继承自顶层的build.gradle文件。<br>app下的build.gradle文件配置了android的配置信息，以及会用到的依赖。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">'com.android.application'</span></span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">24</span></span><br><span class="line">    buildToolsVersion rootProject.buildToolsVersion</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">"com.example.android.testing.espresso.BasicSample"</span></span><br><span class="line">        minSdkVersion <span class="number">10</span></span><br><span class="line">        targetSdkVersion <span class="number">24</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">"1.0"</span></span><br><span class="line">        testInstrumentationRunner <span class="string">"android.support.test.runner.AndroidJUnitRunner"</span></span><br><span class="line">    &#125;</span><br><span class="line">    lintOptions &#123;</span><br><span class="line">        abortOnError <span class="keyword">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    productFlavors &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="comment">// App dependencies</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:support-annotations:'</span> + rootProject.supportLibVersion;</span><br><span class="line">    <span class="keyword">compile</span> <span class="string">'com.google.guava:guava:18.0'</span></span><br><span class="line">    <span class="comment">// Testing-only dependencies</span></span><br><span class="line">    <span class="comment">// Force usage of support annotations in the test app, since it is internally used by the runner module.</span></span><br><span class="line">    androidTestCompile <span class="string">'com.android.support:support-annotations:'</span> + rootProject.supportLibVersion;</span><br><span class="line">    androidTestCompile <span class="string">'com.android.support.test:runner:'</span> + rootProject.runnerVersion;</span><br><span class="line">    androidTestCompile <span class="string">'com.android.support.test:rules:'</span> + rootProject.rulesVersion;</span><br><span class="line">    androidTestCompile <span class="string">'com.android.support.test.espresso:espresso-core:'</span> + rootProject.espressoVersion;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>BasicSample APP就长样子。<br><img src="/image/启动espresso.png" alt="启动espresso"></p>
<h4 id="u542F_u52A8_u6A21_u62DF_u5668"><a href="#u542F_u52A8_u6A21_u62DF_u5668" class="headerlink" title="启动模拟器"></a>启动模拟器</h4><p>首先启动android emulator/genymotion,之后直接点击run按钮就能部署app到模拟器上。<br>log如下.<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Testing started at <span class="number">2</span>:<span class="number">32</span> PM ...</span><br><span class="line"></span><br><span class="line"><span class="number">12</span>/<span class="number">09</span> <span class="number">14</span>:<span class="number">32</span>:<span class="number">04</span>: Launching ChangeTextBehaviorTe...</span><br><span class="line">$ adb push /Users/lqi/work/test/android/android-testing/ui/espresso/BasicSample/app/build/outputs/apk/app-debug<span class="class">.apk</span> /data/local/tmp/com<span class="class">.example</span><span class="class">.android</span><span class="class">.testing</span><span class="class">.espresso</span><span class="class">.BasicSample</span></span><br><span class="line">$ adb shell pm install -r <span class="string">"/data/local/tmp/com.example.android.testing.espresso.BasicSample"</span></span><br><span class="line">	pkg: /data/local/tmp/com<span class="class">.example</span><span class="class">.android</span><span class="class">.testing</span><span class="class">.espresso</span><span class="class">.BasicSample</span></span><br><span class="line">Success</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ adb push /Users/lqi/work/test/android/android-testing/ui/espresso/BasicSample/app/build/outputs/apk/app-debug-androidTest-unaligned<span class="class">.apk</span> /data/local/tmp/com<span class="class">.example</span><span class="class">.android</span><span class="class">.testing</span><span class="class">.espresso</span><span class="class">.BasicSample</span><span class="class">.test</span></span><br><span class="line">$ adb shell pm install -r <span class="string">"/data/local/tmp/com.example.android.testing.espresso.BasicSample.test"</span></span><br><span class="line">	pkg: /data/local/tmp/com<span class="class">.example</span><span class="class">.android</span><span class="class">.testing</span><span class="class">.espresso</span><span class="class">.BasicSample</span><span class="class">.test</span></span><br><span class="line">Success</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Running tests</span><br><span class="line"></span><br><span class="line">$ adb shell am instrument -w -r   -e debug false -e class com<span class="class">.example</span><span class="class">.android</span><span class="class">.testing</span><span class="class">.espresso</span><span class="class">.BasicSample</span><span class="class">.ChangeTextBehaviorTest</span> com<span class="class">.example</span><span class="class">.android</span><span class="class">.testing</span><span class="class">.espresso</span><span class="class">.BasicSample</span><span class="class">.test</span>/android<span class="class">.support</span><span class="class">.test</span><span class="class">.runner</span><span class="class">.AndroidJUnitRunner</span></span><br><span class="line">Client not ready yet..</span><br><span class="line">Started running tests</span><br><span class="line">Tests ran to completion.</span><br></pre></td></tr></table></figure></p>
<h4 id="u7F16_u5199_u6D4B_u8BD5"><a href="#u7F16_u5199_u6D4B_u8BD5" class="headerlink" title="编写测试"></a>编写测试</h4><p>此实例BasicSample包含1个textView,1个EditText和2个button，当点击change text 按钮时，会将edittext的值填入textview中。当点击open activity and change text 按钮时，将打开一个新的页面（姑且叫这样吧）并将edittext内容显示在这个页面。<br><code>@RunWith(AndroidJUnit4.class)</code><br>采用了JUnit 4风格进行编写</p>
<ul>
<li>首先我们需要新建一个测试类。<br><code>ChangeTextBehaviorTest</code></li>
</ul>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChangeTextBehaviorTest</span> </span>&#123;  </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>首先创建一个@Rule,ActivityTestRule用来指明被测试的Activity;<br>@Rule: 简单来说，是为各个测试方法提供一些支持。具体来说，比如我需要测试一个Activity，那么我可以在@Rule注解下面采用一个ActivityTestRule，该类提供了对相应Activity的功能测试的支持。该类可以在@Before和@Test标识的方法执行之前确保将Activity运行起来，并且在所有@Test和@After方法执行结束之后将Activity杀死。在整个测试期间，每个测试方法都可以直接对相应Activity进行修改和访问。</li>
</ul>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@Rule</span></span><br><span class="line">       <span class="keyword">public</span> ActivityTestRule&lt;MainActivity&gt; mActivityRule = <span class="keyword">new</span> ActivityTestRule&lt;&gt;(</span><br><span class="line">           MainActivity.<span class="keyword">class</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>标识一个测试方法。一个测试类中可以有多个测试方法，每个测试方法需要用一个@Test注解来标识。<br>以下代码找到editTextUserInput输入‘Espresso’，关闭键盘。点击changeTextBt按钮。检查textToBeChanged的值是否为‘Espresso’。<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@Test<span class="preprocessor"></span><br><span class="line">public</span><span class="preprocessor"> void</span><span class="preprocessor"> changeText_sameActivity</span>() &#123;</span></span><br><span class="line">    <span class="comment">// Type text and then press the button.</span></span><br><span class="line">    <span class="function">onView</span>(<span class="function">withId</span>(R<span class="class">.id</span><span class="class">.editTextUserInput</span>))</span><br><span class="line">            <span class="class">.perform</span>(<span class="function">typeText</span>(STRING_TO_BE_TYPED), <span class="function">closeSoftKeyboard</span>());</span><br><span class="line">    <span class="function">onView</span>(<span class="function">withId</span>(R<span class="class">.id</span><span class="class">.changeTextBt</span>))<span class="class">.perform</span>(<span class="function">click</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check that the text was changed.</span></span><br><span class="line">    <span class="function">onView</span>(<span class="function">withId</span>(R<span class="class">.id</span><span class="class">.textToBeChanged</span>))<span class="class">.check</span>(<span class="function">matches</span>(<span class="function">withText</span>(STRING_TO_BE_TYPED)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>顺便说说其他junit4注解的用法</p>
<pre><code>@Before: 标识在运行测试方法之前运行的代码。可以支持同一个Class中有多个@Before，但是这些方法的执行顺序是随机的。该注解替代了JUnit 3中的setUp()方法。
@After: 标识在运行测试方法结束之后运行的代码。可以在其中做一些释放资源的操作。该注解替代了JUnit 3中的tearDown()方法。
@BeforeClass: 为测试类标识一个static方法，在测试之前只执行一次。
@AfterClass: 为测试类标识一个static方法，在所有测试方法结束之后只执行一次。
@Test(timeout=&lt;milliseconds&gt;): 为测试方法设定超时时间。
</code></pre><p>到了这里我们要说下怎么定位所需的元素，其实和web差不多，我们可以利用layout inspector与android device monitor工具。<br><img src="/image/android_device_monitor.png" alt="android_device_monitor"><br><img src="/image/android_layout_inspector.png" alt="android_device_monitor"><br>在写一个测试，在editTextUserInput输入‘Espresso’，之后关闭键盘。点击activityChangeTextBtn按钮，查看show_text_view的值是否为‘Espresso’。<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@Test</span><br><span class="line"> <span class="preprocessor"> public</span><span class="preprocessor"> void</span><span class="preprocessor"> changeText_newActivity</span>() &#123;</span></span><br><span class="line">      <span class="comment">// Type text and then press the button.</span></span><br><span class="line">      <span class="function">onView</span>(<span class="function">withId</span>(R<span class="class">.id</span><span class="class">.editTextUserInput</span>))<span class="class">.perform</span>(<span class="function">typeText</span>(STRING_TO_BE_TYPED),</span><br><span class="line">              <span class="function">closeSoftKeyboard</span>());</span><br><span class="line">      <span class="function">onView</span>(<span class="function">withId</span>(R<span class="class">.id</span><span class="class">.activityChangeTextBtn</span>))<span class="class">.perform</span>(<span class="function">click</span>());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// This view is in a different Activity, no need to tell Espresso.</span></span><br><span class="line">      <span class="function">onView</span>(<span class="function">withId</span>(R<span class="class">.id</span><span class="class">.show_text_view</span>))<span class="class">.check</span>(<span class="function">matches</span>(<span class="function">withText</span>(STRING_TO_BE_TYPED)));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>以上是espresso最常见的测试，希望大家能够好好理解。</p>
<h3 id="u63A5_u4E0B_u6765_u6211_u4EEC_u770B_u770Bespresso_u5982_u4F55_u5BF9AdapterView_u63A7_u5236_u5668_u6D4B_u8BD5_u3002"><a href="#u63A5_u4E0B_u6765_u6211_u4EEC_u770B_u770Bespresso_u5982_u4F55_u5BF9AdapterView_u63A7_u5236_u5668_u6D4B_u8BD5_u3002" class="headerlink" title="接下来我们看看espresso如何对AdapterView控制器测试。"></a>接下来我们看看espresso如何对AdapterView控制器测试。</h3><p>​AdapterView​ 是一个从适配器中动态加载数据的特殊控件。最常见的 ​AdapterView​ 是 ListView​。与像 ​LinearLayout​ 这样的静态控件相反，在当前视图结构中，可能只加载了 ​AdapterView​ 子控件的一部分， 简单的 ​onview()​ 可能会找不到当前没有被加载的视图。Espresso 通过提供单独的 onData()​方法来切入点处理此问题，它可以在操作适配器中有该问题的条目或该条目的子项之前将其加载（使其获取焦点）。<br>导入espresso demo中的MultiWindowSample项目<br>该测试是从ArrayAdapter类型的dropdown_item控件中选出需要的值，类似我们用搜索引擎时，显示的list。<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@Test</span><br><span class="line">  <span class="preprocessor"> public</span><span class="preprocessor"> void</span><span class="preprocessor"> autoCompleteTextView_onDataClickAndCheck</span>() &#123;</span></span><br><span class="line">       <span class="comment">// NB: The autocompletion box is implemented with a ListView, so the preferred way</span></span><br><span class="line">       <span class="comment">// to interact with it is onData(). We can use inRoot here too!</span></span><br><span class="line">       <span class="function">onView</span>(<span class="function">withId</span>(R<span class="class">.id</span><span class="class">.auto_complete_text_view</span>))</span><br><span class="line">               <span class="class">.perform</span>(<span class="function">typeText</span>("S"), <span class="function">closeSoftKeyboard</span>());</span><br><span class="line"></span><br><span class="line">       <span class="comment">// This is useful because some of the completions may not be part of the View Hierarchy</span></span><br><span class="line">       <span class="comment">// unless you scroll around the list.</span></span><br><span class="line">       <span class="function">onData</span>(<span class="function">allOf</span>(<span class="function">instanceOf</span>(String<span class="class">.class</span>), <span class="function">is</span>("Baltic Sea")))</span><br><span class="line">               <span class="class">.inRoot</span>(<span class="function">withDecorView</span>(<span class="function">not</span>(<span class="function">is</span>(mActivity<span class="class">.getWindow</span>()<span class="class">.getDecorView</span>()))))</span><br><span class="line">               <span class="class">.perform</span>(<span class="function">click</span>());</span><br><span class="line"></span><br><span class="line">       <span class="comment">// The text should be filled in.</span></span><br><span class="line">       <span class="function">onView</span>(<span class="function">withId</span>(R<span class="class">.id</span><span class="class">.auto_complete_text_view</span>))</span><br><span class="line">               <span class="class">.check</span>(<span class="function">matches</span>(<span class="function">withText</span>("Baltic Sea")));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>，AutoCompleteText的选择等。 这些测试项都有一个共同的特点。即不在主UI布局的结构(layout,及其include的layout)之中，是不能直接定位的。 所以这里就需要使用inRoot( ) 了。<br><code>onData(allOf(instanceOf(String.class), is(&quot;Baltic Sea&quot;)))
        .inRoot(withDecorView(not(is(mActivity.getWindow().getDecorView()))))
        .perform(click());</code><br>以上代码就解决了之前UiAutomator不支持Toast的验证的问题。</p>
<h3 id="u8FD0_u884C_u6D4B_u8BD5"><a href="#u8FD0_u884C_u6D4B_u8BD5" class="headerlink" title="运行测试"></a>运行测试</h3><p>运行测试的方法很多，第一种命令行执行。<br>切换到当前项目目录，终端运行<br><code>./gradlew cAT</code><br>其中，cAT意为connectedAndroidTest。</p>
<p>另一种方式是在android studio中，点击run按钮，或者右键执行单一测试。<br><img src="/image/android_test.png" alt="android_device_monitor"></p>
<p>这一章还是以基础的实践为主，之后我们将深入架构，来看看espresso的API 方法，帮助大家理解API 更好更快的编写测试。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/02/espresso2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qi lei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QA seven's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/02/espresso2/" itemprop="url">espresso基础架构与API分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-02T11:57:43+08:00">
                2016-12-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="espresso_u57FA_u7840_u67B6_u6784_u4E0EAPI_u5206_u6790"><a href="#espresso_u57FA_u7840_u67B6_u6784_u4E0EAPI_u5206_u6790" class="headerlink" title="espresso基础架构与API分析"></a>espresso基础架构与API分析</h2><p>Espresso测试框架提供了一组API来构建UI测试，以测试应用程序内的用户流。 这些API让您能够编写简洁，运行可靠的自动化UI测试。 Espresso非常适合编写白盒式自动化测试，其中测试代码使用来自所测试的应用程序的实现代码细节。</p>
<p>Espresso测试框架的主要功能包括：</p>
<p>用于在目标应用程序中查看和适配器匹配的灵活API。 有关详细信息，请参阅<a href="https://developer.android.com/topic/libraries/testing-support-library/index.html#espresso-matching" target="_blank" rel="external">View matching</a>。<br>一组广泛的操作API，用于自动化UI交互。 有关更多信息，请参阅<a href="https://developer.android.com/topic/libraries/testing-support-library/index.html#espresso-actions" target="_blank" rel="external"> Action APIs</a>。<br>UI线程同步提高测试的可靠性。 有关更多信息，请参阅 <a href="https://developer.android.com/topic/libraries/testing-support-library/index.html#espresso-thread-sync" target="_blank" rel="external">UI thread synchronization</a>。<br>可以作为参数传入 ​ViewInteraction.check()​方法中的 ViewAssertion 的集合。通常，你会使用带有视图匹配器的匹配断言来判断当前被选中视图的状态，请参阅<a href="https://developer.android.com/reference/android/support/test/espresso/assertion/package-summary.html" target="_blank" rel="external">ViewAssertions</a><br>需要Android 2.2（API级别8）或更高版本。</p>
<h2 id="View_matching"><a href="#View_matching" class="headerlink" title="View matching"></a>View matching</h2><h3 id="onView_28_29"><a href="#onView_28_29" class="headerlink" title="onView()"></a>onView()</h3><p>Espresso.onView()方法允许您访问目标应用程序中的UI组件并与其进行交互。 该方法接受Matcher参数并搜索视图层次以定位满足某些给定标准的对应View实例。 您可以通过指定以下条件来优化搜索：</p>
<ul>
<li>视图的类名</li>
<li>视图的内容描述</li>
<li>视图的R.id</li>
<li>视图中显示的文本<br>例如，要定位ID值为my_button的按钮，您可以指定一个匹配器，如下所示：</li>
</ul>
<p><code>onView（withId（R.id.my_button））;</code><br>如果搜索成功，onView()方法返回一个引用，该引用允许您对目标视图执行用户操作和测试断言。</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function">ViewInteraction <span class="title">onView</span><span class="params">(<span class="keyword">final</span> Matcher&lt;View&gt; viewMatcher)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> BASE.plus(<span class="keyword">new</span> ViewInteractionModule(viewMatcher)).viewInteraction();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="ViewMatchers"><a href="#ViewMatchers" class="headerlink" title="ViewMatchers"></a>ViewMatchers</h4><p>onView方法需要传入类型为Matcher<view>泛型viewMatcher对象.</view></p>
<p>ViewMatchers类中方法有<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isAssignableFrom，withClassName，isDisplayed，isCompletelyDisplayed，isDisplayingAtLeast，isEnabled，isFocusable，hasFocus，isSelected，hasSibling，withContentDescription，withContentDescription，withContentDescription，withId，withResourceName，withTagKey，withTagValue，withText，withCharSequence，withHint，isChecked，isNotChecked，withCheckBoxState，hasContentDescription，hasDescendant，isClickable，isDescendantOfA，withEffectiveVisibility，withParent，withChild，isRoot，supportsInputMethods，hasImeAction，hasImeAction，hasLinks，assertThat，withSpinnerText，isJavascriptEnabled，hasErrorText，withInputType。</span><br></pre></td></tr></table></figure></p>
<p> 这些方法能够帮助我们快速定位到特定的视图。<br> 我们来看看常用的几个方法<br> withId<br> 返回基于资源ids匹配视图的匹配器。<br> withText<br> 返回基于TextView的文本属性值匹配TextView的匹配器。<br><code>onView(allOf(withId(R.id.my_view), withText(&quot;Hello!&quot;)))</code><br> isDisplayed<br> 返回与当前显示在屏幕上的视图匹配的匹配器给用户。<br> 如下</p>
<p> <code>Espresso.onView(ViewMatchers.withId(R.id.mpu_summary_send_receipt_button))
          .check(ViewAssertions.matches(ViewMatchers.isDisplayed()));</code><br>其他API方法可以在以下文档中找到具体用法和解释，我们并不需要记住每个方法，遇到具体的场景的时候再过来查询也来得及<br><a href="https://developer.android.com/reference/android/support/test/espresso/matcher/ViewMatchers.html" target="_blank" rel="external">viewmatchers-API</a></p>
<h4 id="ViewMatchers_u4E0Ehamcrest_u5339_u914D_u5668_u914D_u5408_u4F7F_u7528"><a href="#ViewMatchers_u4E0Ehamcrest_u5339_u914D_u5668_u914D_u5408_u4F7F_u7528" class="headerlink" title="ViewMatchers与hamcrest匹配器配合使用"></a>ViewMatchers与hamcrest匹配器配合使用</h4><p><strong>什么是hamcrest？</strong></p>
<p>Hamcrest框架是junit4框架新引入的断言框架，Hamcest提供了一套匹配符Matcher，这些匹配符更接近自然语言，可读性高，更加灵活。<br>我们可以通过各种viewmatchers与Hamcrest组合匹配器来缩小搜索的范围。<br>如以下示例所示：</p>
<p><code>onView(allOf(withId(R.id.button_signin), withText(&quot;Sign-in&quot;)));</code></p>
<p>你也可以使用 ​not​ 反转匹配：</p>
<p><code>onView(allOf(withId(R.id.button_signin), not(withText(&quot;Sign-out&quot;))));</code><br><strong>注意：</strong><br>一个工程化的应用中，所有用户可与之交互的视图都应该包含说明文字或有一个内容描述（参考 Android 可访问性指导）。如果你不能通过使用 ‘withText’ 或 ‘withContentDescripiton’ 来缩小onView的搜索范围，可以认为这是一个可访问性的 bug。</p>
<p>请使用最少的匹配器来定位视图。不要过指定，因为这将强制框架做无用功。例如，如果一个视图可以通过它的文字唯一确定，你不需要说明该视图也可以通过 ​TextView​ 指定。对许多视图而言，使用它的​R.id​值就足够了。</p>
<p>更多的hamcrest api请查看<br><a href="http://hamcrest.org/JavaHamcrest/javadoc/1.3/" target="_blank" rel="external">hamcrest api</a></p>
<p>###onData<br>当espresso在AdapterView中查找视图时需要用onData方法，例如在AdapterView小部件中，视图在运行时动态填充子视图。如果要测试的目标视图位于AdapterView（例如ListView，GridView或Spinner）中，则onView()方法可能无法工作，因为只有一部分视图可能会加载到当前视图层次结构中。</p>
<p>相反，调用onData()方法可获取DataInteraction对象以访问目标视图元素。 Espresso处理将目标视图元素加载到当前视图层次结构中。 Espresso还负责滚动到目标元素，并将放在焦点元素。</p>
<p>注意：onData()方法不检查您指定的项目是否与视图对应。 Espresso仅搜索当前视图层次结构。如果没有找到匹配，该方法将抛出NoMatchingViewException异常。</p>
<p>下面的代码片段展示了如何使用onData()方法和Hamcrest匹配来搜索包含给定字符串的列表中的特定行。在此示例中，LongListActivity类包含通过SimpleAdapter公开的字符串列表。</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">onData<span class="list">(<span class="keyword">allOf</span><span class="list">(<span class="keyword">is</span><span class="list">(<span class="keyword">instanceOf</span><span class="list">(<span class="keyword">Map</span>.class)</span>)</span>,</span><br><span class="line">        hasEntry<span class="list">(<span class="keyword">equalTo</span><span class="list">(<span class="keyword">LongListActivity</span>.ROW_TEXT)</span>, is<span class="list">(<span class="string">"test input"</span>)</span>)</span>)</span><span class="comment">;</span></span></span><br></pre></td></tr></table></figure>
<h2 id="Performing_Actions"><a href="#Performing_Actions" class="headerlink" title="Performing Actions"></a>Performing Actions</h2><p>调用ViewInteraction.perform()或DataInteraction.perform()方法来模拟UI组件上的用户交互。您必须传入一个或多个ViewAction对象作为参数。Espresso按照给定的顺序依次触发每个动作，并在主线程中执行它们。<br>ViewActions类提供了指定常用操作的帮助方法列表。您可以使用这些方法作为方便的快捷方式，而不是创建和配置单个ViewAction对象。您可以指定以下操作：</p>
<ul>
<li>ViewActions.click()：点击视图。</li>
<li>ViewActions.typeText()：点击视图并输入指定的字符串。</li>
<li>ViewActions.scrollTo()：滚动到视图。目标视图必须是来自ScrollView的子类，它的android：visibility属性的值必须是VISIBLE。对于扩展AdapterView（例如，ListView）的视图，onData()方法为您处理滚动。</li>
<li>ViewActions.pressKey()：使用指定的键码执行键按下。</li>
<li>ViewActions.clearText()：清除目标视图中的文本。<br>如果目标视图位于ScrollView内部，请先执行ViewActions.scrollTo()操作，以在其他操作进行之前在屏幕中显示视图。如果视图已显示，ViewActions.scrollTo()操作将不起作用。</li>
</ul>
<p>例如，要模拟输入字符串值并按按钮提交值，您可以编写类似这样的自动测试脚本。 ViewInteraction.perform()和DataInteraction.perform()方法采用一个或多个ViewAction参数，并按提供的顺序运行操作。</p>
<p>//将文本键入EditText视图，然后关闭软键盘<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">onView<span class="list">(<span class="keyword">withId</span><span class="list">(<span class="keyword">R</span>.id.editTextUserInput)</span>）</span><br><span class="line">     .perform<span class="list">(<span class="keyword">typeText</span><span class="list">(<span class="keyword">STRING_TO_BE_TYPED</span>)</span>,closeSoftKeyboard<span class="list">()</span>）<span class="comment">;</span></span></span></span><br></pre></td></tr></table></figure></p>
<p>//按按钮提交文本更改<br><code>onView(withId(R.id.changeTextBt)).perform(click());</code></p>
<p>其他action api 请查看<br><a href="/espresso.action">https://developer.android.com/reference/android/support/test/espresso/action/package-summary.html</a></p>
<h2 id="Verifying_Results"><a href="#Verifying_Results" class="headerlink" title="Verifying Results"></a>Verifying Results</h2><p>调用ViewInteraction.check()或DataInteraction.check()方法来断言UI中的视图匹配一些预期状态。 您必须传递一个ViewAssertion对象作为参数。 如果断言失败，Espresso会抛出一个AssertionFailedError。<br>ViewAssertions类提供了用于指定公共断言的帮助程序方法的列表。 您可以使用的断言包括：<br>doesNotExist：断言没有与当前视图层次结构中指定的条件匹配的视图。<br>matches：断言指定视图存在于当前视图层次结构中，并且其状态与某个给定的Hamcrest匹配器匹配。<br>selectedDescendentsMatch：存在指定的孩子为父视图查看的声明，它们的状态与某个给定的Hamcrest匹配器匹配。</p>
<p>以下代码段显示了如何检查UI中显示的文本的值与之前在EditText字段中输入的文本的值相同。<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public void <span class="function">testChangeText_sameActivity</span>() &#123;</span><br><span class="line">    <span class="comment">// Type text and then press the button.</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function">onView</span>(<span class="function">withText</span>(R<span class="class">.string</span><span class="class">.item_1_text</span>))</span><br><span class="line">            <span class="class">.check</span>(<span class="function">doesNotExist</span>());</span><br><span class="line">    <span class="comment">// Check that the text was changed.</span></span><br><span class="line">    <span class="function">onView</span>(<span class="function">withId</span>(R<span class="class">.id</span><span class="class">.textToBeChanged</span>))</span><br><span class="line">            <span class="class">.check</span>(<span class="function">matches</span>(<span class="function">withText</span>(STRING_TO_BE_TYPED)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ViewMatchers, ViewActions, ViewAssertions 组成了espresso的基础架构，所以要真正的掌握espresso必须将这3部分基础熟悉。<br>上一节<a href="https://qaseven.github.io/2016/11/30/expresso/" target="_blank" rel="external">espresso基础</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/30/expresso/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qi lei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QA seven's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/30/expresso/" itemprop="url">espresso系列一简介</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-30T16:59:53+08:00">
                2016-11-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="espresso_u662F_u4EC0_u4E48_uFF1F"><a href="#espresso_u662F_u4EC0_u4E48_uFF1F" class="headerlink" title="espresso是什么？"></a>espresso是什么？</h2><p> Espresso 测试框架提供了一系列的API用于构建UI测试来测试app内用户流操作。这些API让你可以编写简洁可靠的自动化UI测试。Espresso非常适合用来编写白盒测试，其中测试代码的编写是利用了被测试app中程序代码实现细节。</p>
<p>Espresso测试可运行android 2.3.3(API 10 level)以及更高版本的设备上。使用Espresso的主要好处是,当你运行测试时它提供了自动的同步测试动作与应用程序UI。Espresso会检测你的主线程是否为空闲状态,如果你的没有被利用,这时候他就会抢占主线程运行测试，所以它能够在恰当的时间运行您的测试命令,提高测试的可靠性。这种能力也使您无须添加任何额外的措施,例如在测试代码中加入<code>thread.sleep()</code>。</p>
<p>Espresso测试框架基于 instrumentation-based API 并且使用 AndroidJUnitRunner测试驱动运行测试。</p>
<p>Espresso测试框架的关键特性包括：</p>
<ul>
<li>[ ] 提供了灵活的API用于匹配目标app中view和adapter。更多的信息，见<a href="https://developer.android.com/topic/libraries/testing-support-library/index.html#espresso-matching" target="_blank" rel="external">View匹配</a></li>
<li>[ ] 大而全的 行为 api（action APIs） 用于自动化UI交互。更多的信息，见<a href="https://developer.android.com/topic/libraries/testing-support-library/index.html#espresso-actions" target="_blank" rel="external">行为APIs</a></li>
<li>[ ] UI线程同步来提高测试可靠性。更多信息，<a href="https://developer.android.com/topic/libraries/testing-support-library/index.html#espresso-thread-sync" target="_blank" rel="external">见UI线程同步</a></li>
</ul>
<h2 id="u7248_u672C_u517C_u5BB9"><a href="#u7248_u672C_u517C_u5BB9" class="headerlink" title="版本兼容"></a>版本兼容</h2><p>Espresso 支持如下 API：</p>
<table>
<thead>
<tr>
<th>代号</th>
<th>API</th>
</tr>
</thead>
<tbody>
<tr>
<td>Froyo</td>
<td>8</td>
</tr>
<tr>
<td>Gingerbread</td>
<td>10</td>
</tr>
<tr>
<td>  Ice Cream Sandwich</td>
<td>15</td>
</tr>
<tr>
<td>  Jelly Bean</td>
<td>16, 17 ,18</td>
</tr>
<tr>
<td>  KitKat</td>
<td>19</td>
</tr>
<tr>
<td>  Lollipop</td>
<td>21</td>
</tr>
</tbody>
</table>
<p>注意：<br>切记 espresso 有版本断层，并不是全版本支持，请注意你设备android系统的版本，以免造成不必要的免费。<br>不过最新的android系统版本 espresso都是支持的。</p>
<h2 id="u914D_u7F6Eespresso"><a href="#u914D_u7F6Eespresso" class="headerlink" title="配置espresso"></a>配置espresso</h2><p>官方文档建议我们在开始配置之前，先看看如何开始测试，我觉得非常有必要，很多新手上来就拿着不知道那找来的例子运行下，就以为自己真的什么都会。这样的真的很不好，官方文档才是最好的老师，让我们一步一步慢慢来。</p>
<p>android是基于JUnit测试框架,单元测试,您可以运行任意本地的单元测试在JVM或instrumented tests在Android设备上。</p>
<h3 id="u6D4B_u8BD5_u7C7B_u578B"><a href="#u6D4B_u8BD5_u7C7B_u578B" class="headerlink" title="测试类型"></a>测试类型</h3><p>当使用Android studio 编写任何你的测试时,你的测试代码必须进入两个不同的代码目录(源集)。每个模块在您的项目中,Android Studio都包括源集,对应于以下测试类型:</p>
<h4 id="u672C_u5730_u5355_u5143_u6D4B_u8BD5"><a href="#u672C_u5730_u5355_u5143_u6D4B_u8BD5" class="headerlink" title="本地单元测试"></a>本地单元测试</h4><p>位于 <code>module-name/src/test/java/.</code></p>
<p>这些测试运行在本地JVM并没有访问Android框架api功能的权限。<br>让我们首先开始如何构建本地单元测试。</p>
<h3 id="u6784_u5EFA_u672C_u5730_u5355_u5143_u6D4B_u8BD5"><a href="#u6784_u5EFA_u672C_u5730_u5355_u5143_u6D4B_u8BD5" class="headerlink" title="构建本地单元测试"></a>构建本地单元测试</h3><p>如果您的单元测试没有依赖或只有简单的依赖Android系统,你应该在本地开发机器上运行您的测试。这种测试方法是有效的,因为它可以帮助你避免加载目标应用程序时的开销以及单元测试需要在一个物理设备或模拟器运行。因此,运行单元测试的时间将大大的减少。使用这种方法,您通常使用mocking 框架,列如Mockito、这可以帮助我们mock测试需要的依赖。</p>
<h3 id="u8BBE_u7F6E_u6D4B_u8BD5_u73AF_u5883"><a href="#u8BBE_u7F6E_u6D4B_u8BD5_u73AF_u5883" class="headerlink" title="设置测试环境"></a>设置测试环境</h3><p>在你的Android Studio项目时,您必须为本地单元测试存储源文件在 module-name/src/test/java/。当你创建一个新项目，这个目录就已经存在。您还需要为您的项目配置测试依赖,因为需要使用JUnit 4的框架提供标准的api。<br>如果您的测试需要与Android依赖关系,包括使用Mockito来简化你的单元测试。更多地使用 mock objects在本地的单元测试中,请查看Mocking Android依赖关系。在你的应用程序的顶层目录的build.gradle文件里,您需要指定这些库的依赖关系:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="comment">// Required -- JUnit 4 framework</span></span><br><span class="line">    testCompile <span class="string">'junit:junit:4.12'</span></span><br><span class="line">    <span class="comment">// Optional -- Mockito framework</span></span><br><span class="line">    testCompile <span class="string">'org.mockito:mockito-core:1.10.19'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u521B_u5EFA_u672C_u5730_u5355_u5143_u6D4B_u8BD5_u7C7B"><a href="#u521B_u5EFA_u672C_u5730_u5355_u5143_u6D4B_u8BD5_u7C7B" class="headerlink" title="创建本地单元测试类"></a>创建本地单元测试类</h3><p>你当地的单元测试类应该写成一个JUnit 4测试类。JUnit是最受欢迎和广泛使用为Java单元测试框架。这个框架的最新版本,JUnit4,允许您在一个比之前的版更清洁和更灵活的方法中编写测试。之前的Android单元测试基于JUnit3框架,使用JUnit4,您不需要扩展junit.framework。TestCase类。你也不需要在测试方法名称包含“test”关键字,或者使用junit的任何类在junit.framework或junit.extensions包。</p>
<p>创建一个基本的JUnit 4测试类,首先需要创建一个Java类,它包含一个或多个测试方法。一个测试方法以@Test annotation标注并且包含代码的实现和验证的代码中包含您想要测试的一个功能组件。</p>
<p>下面的例子展示了如何实现一个本地的单元测试类。测试方法emailValidator_CorrectEmailSimple_ReturnsTrue验证isValidEmail()方法，应用程序返回正确的结果。<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"><span class="keyword">import</span> org.junit.Test;</span></span><br><span class="line"><span class="preprocessor"><span class="keyword">import</span> java.util.regex.Pattern;</span></span><br><span class="line"><span class="preprocessor"><span class="keyword">import</span> static org.junit.Assert.assertFalse;</span></span><br><span class="line"><span class="preprocessor"><span class="keyword">import</span> static org.junit.Assert.assertTrue;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmailValidatorTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> emailValidator_CorrectEmailSimple_ReturnsTrue() &#123;</span><br><span class="line">        assertThat(EmailValidator.isValidEmail(<span class="string">"name@email.com"</span>), <span class="keyword">is</span>(<span class="literal">true</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试组件在应用程序返回预期的结果,使用junit.Assert方法来执行验证检查(或断言)来对比测试组件的状态和一些期望值。为了使测试具有更好的可读的,您可以使用Hamcrest matchers(如 is()和equalTo()方法)来匹配返回的结果与预期的结果。</p>
<h3 id="Mock_Android_u4F9D_u8D56_u5173_u7CFB"><a href="#Mock_Android_u4F9D_u8D56_u5173_u7CFB" class="headerlink" title="Mock Android依赖关系"></a>Mock Android依赖关系</h3><p>默认情况下,Android插件Gradle执行本地的单元测试与修改后的版本的Android.jar库,它不包含任何实际的代码。相反,从你的单元测试方法调用安卓类抛出异常。这确保你的测试代码和不依赖于任何特定的行为的Android平台(你没有显式地mock)。<br>您可以使用模拟框架在代码中存根外部依赖关系，以便轻松测试您的组件是否按照预期的方式与依赖关系交互。 通过用模拟对象替换Android依赖项，您可以将单元测试与Android系统的其余部分隔离，同时验证这些依赖关系中的正确方法是否被调用。 Java的Mockito mocking框架（1.9.5及更高版本）提供了与Android单元测试的兼容性。 使用Mockito，您可以配置模拟对象以在调用时返回一些特定值。</p>
<p>要使用此框架将mock对象添加到本地单元测试，请遵循以下编程模型：</p>
<ul>
<li>在build.gradle文件中包含Mockito库依赖关系，如设置测试环境中所述。</li>
<li>在单元测试类定义的开始，添加@RunWith（MockitoJUnitRunner.class）注释。 这个注释告诉Mockito测试运行器验证你的框架的使用是正确的，并简化了你的模拟对象的初始化。</li>
<li>要为Android依赖项创建模拟对象，请在字段声明之前添加@Mock注释。</li>
<li>要存根依赖关系的行为，可以使用when（）和thenReturn（）方法指定条件并返回值。</li>
</ul>
<p>以下示例显示如何创建使用mock上下文对象的单元测试。<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.<span class="type">MatcherAssert</span>.assertThat;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.<span class="type">CoreMatchers</span>.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.<span class="type">Mockito</span>.*;</span><br><span class="line"><span class="keyword">import</span> org.junit.<span class="type">Test</span>;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.<span class="type">RunWith</span>;</span><br><span class="line"><span class="keyword">import</span> org.mockito.<span class="type">Mock</span>;</span><br><span class="line"><span class="keyword">import</span> org.mockito.runners.<span class="type">MockitoJUnitRunner</span>;</span><br><span class="line"><span class="keyword">import</span> android.content.<span class="type">SharedPreferences</span>;</span><br><span class="line"></span><br><span class="line">@<span class="type">RunWith</span>(<span class="type">MockitoJUnitRunner</span>.class)</span><br><span class="line">public class <span class="type">UnitTestSample</span> &#123;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">static</span> final <span class="type">String</span> <span class="type">FAKE_STRING</span> = <span class="string">"HELLO WORLD"</span>;</span><br><span class="line"></span><br><span class="line">    @<span class="type">Mock</span></span><br><span class="line">    <span class="type">Context</span> mMockContext;</span><br><span class="line"></span><br><span class="line">    @<span class="type">Test</span></span><br><span class="line">    public <span class="type">void</span> readStringFromContext_LocalizedString() &#123;</span><br><span class="line">        // <span class="type">Given</span> a mocked <span class="type">Context</span> injected into the <span class="keyword">object</span> under test...</span><br><span class="line">        <span class="keyword">when</span>(mMockContext.getString(R.<span class="type">string</span>.hello_word))</span><br><span class="line">                .thenReturn(<span class="type">FAKE_STRING</span>);</span><br><span class="line">        <span class="type">ClassUnderTest</span> myObjectUnderTest = new <span class="type">ClassUnderTest</span>(mMockContext);</span><br><span class="line"></span><br><span class="line">        // ...<span class="keyword">when</span> the <span class="type">string</span> <span class="keyword">is</span> returned <span class="keyword">from</span> the <span class="keyword">object</span> under test...</span><br><span class="line">        <span class="type">String</span> <span class="literal">result</span> = myObjectUnderTest.getHelloWorldString();</span><br><span class="line"></span><br><span class="line">        // ...then the <span class="literal">result</span> should be the expected one.</span><br><span class="line">        assertThat(<span class="literal">result</span>, <span class="keyword">is</span>(<span class="type">FAKE_STRING</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>要了解有关使用Mockito框架的更多信息，请参阅示例代码中的Mockito API参考和SharedPreferencesHelperTest类。<br>如果Android.jar中的Android API抛出的异常对于测试有问题，您可以更改行为，以使方法通过在项目的顶级build.gradle文件中添加以下配置来返回null或零：<br><code>android {
  ...
  testOptions {
    unitTests.returnDefaultValues = true
  }
}</code></p>
<p>警告：将returnDefaultValues属性设置为true应该小心。  null/zero 返回值可以在测试中引入回归，这难以调试，并且可能允许失败的测试通过。 只能使用它作为最后的手段。</p>
<h3 id="u8FD0_u884C_u672C_u5730_u6D4B_u8BD5"><a href="#u8FD0_u884C_u672C_u5730_u6D4B_u8BD5" class="headerlink" title="运行本地测试"></a>运行本地测试</h3><p>要运行本地单元测试，请按照下列步骤操作：</p>
<ol>
<li>通过单击工具栏中的 Sync Project，确保您的项目与Gradle同步。</li>
<li>使用以下方法之一运行测试：</li>
</ol>
<ul>
<li>要运行单个测试，请打开“Project”窗口，然后右键单击测试，然后单击RUN。</li>
<li>要测试类中的所有方法，请右键单击测试文件中的类或方法，然后单击Run。</li>
<li>要在目录中运行所有测试，请右键单击目录并选择Run test。<br>Gradle的Android插件编译位于默认目录（src / test / java /）中的本地单元测试代码，构建一个测试应用程序，并使用默认的测试运行器类在本地执行它。 然后，Android Studio将在“运行”窗口中显示结果。</li>
</ul>
<h4 id="Instrumented_tests"><a href="#Instrumented_tests" class="headerlink" title="Instrumented tests"></a>Instrumented tests</h4><p>位于module-name/src/androidTest/java/。<br>这些都是必须在Android硬件设备或Android模拟器上运行的测试。</p>
<p>仪表化测试内置于在测试下的应用旁边的设备上运行的APK。 系统在同一个过程中运行测试APK和您的应用程序，因此您的测试可以调用方法和修改应用程序中的字段，并自动化用户与您的应用程序的互动。</p>
<p>有关如何创建检测测试的信息，请参阅以下主题：</p>
<p>构建测试单元测试：使用Android依赖项构建复杂的单元测试，这些测试不能满足模拟对象。<br>自动化用户界面测试：创建测试以验证用户界面在单个应用程序内的用户交互或多个应用程序之间的交互操作正确。<br>测试应用程序组件集成：验证用户不直接与之交互的组件（例如服务或内容提供者）的行为。<br><img src="https://developer.android.com/images/testing/test-types_2x.png" alt=""><br>但是，上述的本地单元测试和instrumented tests只是用于区分在本地JVM上运行的测试和在Android平台（在硬件设备或模拟器上）运行的测试之间的术语。 在构建完整测试套件时应该理解的真实测试类型在下表中描述。</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>子类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Unit tests</td>
<td>Local Unit Tests</td>
<td>本地单元测试在Java虚拟机（JVM）上本地运行的单元测试。当您的测试没有Android框架依赖项或者可以模拟Android框架依赖项时，使用这些测试来最小化执行时间。</td>
</tr>
<tr>
<td>Unit tests</td>
<td>Instrumented unit tests</td>
<td>测试单元测试在Android设备或模拟器上运行的单元测试。这些测试可以访问Instrumentation信息，例如您要测试的应用程序的上下文。当你的测试有Android依赖，模拟对象不能满足时，使用这些测试。</td>
</tr>
<tr>
<td>Integration Tests</td>
<td>Components within your app only</td>
<td>您的应用程序中的组件仅当用户执行特定操作或在其活动中输入特定输入时，此类型的测试验证目标应用程序的行为如预期。例如，它允许您检查目标应用程序返回正确的UI输出，以响应用户在应用程序活动中的互动。 Espresso等UI测试框架允许您以编程方式模拟用户操作并测试复杂的应用内用户交互。</td>
</tr>
<tr>
<td>Integration Tests</td>
<td>Cross-app Components</td>
<td>跨应用程序组件此类型的测试验证不同用户应用程序之间或用户应用程序和系统应用程序之间的交互的正确行为。例如，当用户在Android设置菜单中执行操作时，您可能需要测试您的应用是否正确运行。支持跨应用程序交互的UI测试框架（如UI Automator）允许您为这些场景创建测试。</td>
</tr>
</tbody>
</table>
<h4 id="Test_APIs"><a href="#Test_APIs" class="headerlink" title="Test APIs"></a>Test APIs</h4><p>以下是用于在Android上测试应用的常见API。<br>JUnit<br>您应该将您的单元或集成测试类写为JUnit 4测试类。 该框架提供了一种方便的方法来在测试中执行常见的setup, teardown, and assertion操作。</p>
<p>基本的JUnit 4测试类是包含一个或多个测试方法的Java类。 测试方法以@Test注释开始，包含练习和验证要测试的组件中的单个功能（即逻辑单元）的代码。</p>
<p>以下代码段显示了一个示例JUnit 4集成测试，它使用Espresso API对UI元素执行单击操作，然后检查是否显示预期的字符串。<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@RunWith</span>(AndroidJUnit4.<span class="keyword">class</span>)</span><br><span class="line"><span class="annotation">@LargeTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivityInstrumentationTest</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Rule</span></span><br><span class="line">    <span class="keyword">public</span> ActivityTestRule mActivityRule = <span class="keyword">new</span> ActivityTestRule&lt;&gt;(</span><br><span class="line">            MainActivity.<span class="keyword">class</span>);</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="typename">void</span> sayHello()&#123;</span><br><span class="line">        onView(withText(<span class="string">"Say hello!"</span>)).perform(click());</span><br><span class="line"></span><br><span class="line">        onView(withId(R.id.textView)).check(matches(withText(<span class="string">"Hello, World!"</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在您的JUnit 4测试类中，您可以通过使用以下注释调用测试代码中的部分进行特殊处理：</p>
<ul>
<li>@Before：使用此注释来指定包含测试设置操作的代码块。测试类在每次测试之前调用此代码块。你可以有多个@Before方法，但是测试类调用这些方法的顺序不能保证。</li>
<li>@After：此注释指定一个包含测试拆分操作的代码块。测试类在每个测试方法之后调用这个代码块。您可以在测试代码中定义多个@After操作。使用此注释从内存释放任何资源。</li>
<li>@Test：使用此注释标记测试方法。单个测试类可以包含多个测试方法，每个测试方法都以此注释作为前缀。</li>
<li>@Rule：规则允许您以可重用的方式灵活地添加或重新定义每个测试方法的行为。在Android测试中，将此注释与Android测试支持库提供的测试规则类之一一起使用，例如ActivityTestRule或ServiceTestRule。</li>
<li>@BeforeClass：使用此注释为每个测试类指定仅调用一次的静态方法。此测试步骤对于消耗大的操作（例如连接到数据库）很有用。</li>
<li>@AfterClass：使用此注释为测试类指定静态方法，仅在类中的所有测试运行后调用。 这个测试步骤对释放在@BeforeClass块中分配的任何资源很有用。</li>
<li>@Test（timeout =）：一些注释支持传递元素的能力，您可以为其设置值。 例如，您可以为测试指定超时期限。 如果测试开始，但没有在给定的超时期间内完成，它会自动失败。 您必须以毫秒为单位指定超时期限，例如：@Test（timeout = 5000）。<br>使用JUnit Assert类来验证对象状态的正确性。 assert方法将您从测试所期望的值与实际结果进行比较，如果比较失败，则抛出异常。 断言类更详细地描述这些方法。<h4 id="Android_u6D4B_u8BD5_u652F_u6301_u5E93"><a href="#Android_u6D4B_u8BD5_u652F_u6301_u5E93" class="headerlink" title="Android测试支持库"></a>Android测试支持库</h4>Android测试支持库提供了一组API，允许您快速构建和运行应用程序的测试代码，包括JUnit 4和功能UI测试。 库包括以下基于工具的API，当您想要自动化测试时，这些API是有用的：</li>
</ul>
<p>AndroidJUnitRunner<br>适用于Android的JUnit 4兼容测试运行器。<br>espresso<br>一个UI测试框架; 适用于在应用程序内的功能UI测试。<br>UI automator<br>适用于系统和已安装应用程序之间跨应用程序功能UI测试的UI测试框架。</p>
<h4 id="u65AD_u8A00_u7C7B"><a href="#u65AD_u8A00_u7C7B" class="headerlink" title="断言类"></a>断言类</h4><p>由于Android测试支持库API扩展JUnit，因此可以使用断言方法显示测试结果。断言方法将测试返回的实际值与预期值进行比较，如果比较测试失败，则抛出AssertionException异常。使用断言比记录更方便，并提供更好的测试性能。</p>
<p>为了简化测试开发，您应该使用Hamcrest库，它允许您使用Hamcrest匹配器API创建更灵活的测试。</p>
<p>Monkey 和 monkeyrunner<br>Android SDK包含两个用于功能级应用测试的工具：</p>
<p>Monkey<br>这是一个命令行工具，用于向设备发送按键，触摸和手势的伪随机流。您使用Android Debug Bridge（adb）工具运行它，并使用它来压力测试您的应用程序，报告所遇到的错误，或通过使用相同的随机数种子多次运行该工具来重复事件流。<br>monkeyrunner<br>此工具是用Python编写的测试程序的API和执行环境。 API包括用于连接到设备，安装和卸载包，截取屏幕截图，比较两个图像以及针对应用运行测试包的功能。使用API​​，您可以编写大量，强大和复杂的测试。您使用monkeyrunner命令行工具运行使用API​​的程序。</p>
<h4 id="u6784_u5EFAAndroid_u6D4B_u8BD5_u7684_u6307_u5357"><a href="#u6784_u5EFAAndroid_u6D4B_u8BD5_u7684_u6307_u5357" class="headerlink" title="构建Android测试的指南"></a>构建Android测试的指南</h4><p>以下文档提供了有关如何构建和运行各种测试类型的更多详细信息：</p>
<p>建立本地单元测试<br>构建单元测试没有依赖或只有简单的依赖，你可以mock，它运行在本地JVM上。<br>建筑仪表单元测试<br>使用Android依赖项构建复杂的单元测试，这对于在硬件设备或模拟器上运行的模拟对象无法满足。<br>自动化用户界面测试<br>创建测试以验证用户界面在单个应用程序内的用户交互或多个应用程序之间的交互正确运行。<br>测试应用程序集成<br>验证用户不直接与之交互的组件（例如服务或内容提供者）的行为。<br>测试显示性能<br>编写测试应用程序UI性能的测试，以确保持续流畅的用户体验。<br>ok 我们已经看完了 怎么开始android测试，我想大家一定有了很深入的了解了吧<br>让我们进入正题 配置espresso<br>在Android应用程序模块的build.gradle文件中，必须为Espresso引入jar依赖：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="comment">// Other dependencies ...</span></span><br><span class="line">    androidTestCompile <span class="string">'com.android.support.test.espresso:espresso-core:2.2.2'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关闭测试设备上的动画 - 在测试设备中打开系统动画可能会导致意外的结果，或可能导致测试失败。 通过打开开发者选项并关闭所有以下选项，从设置中关闭动画：</p>
<ul>
<li>在设备上的设置-&gt;开发者选项中禁用一下三项设置： &gt; 窗口动画缩放 &gt; 过渡动画缩放 &gt; 动画程序时长缩放</li>
<li>确保你已经安装了最新的 Extras 下的 Android Support Repository<br>设置junit为测试驱动框架<br>在build.gradle 中 添加<br><code>testInstrumentationRunner &quot;android.support.test.runner.AndroidJUnitRunner&quot;</code><h2 id="u5B8C_u6574_u7684build-gradle__u793A_u4F8B_u6587_u4EF6_u5982_u4E0B"><a href="#u5B8C_u6574_u7684build-gradle__u793A_u4F8B_u6587_u4EF6_u5982_u4E0B" class="headerlink" title="完整的build.gradle 示例文件如下"></a>完整的build.gradle 示例文件如下</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">​android.defaultConfigpply plugin: <span class="string">'com.android.application'</span></span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">24</span></span><br><span class="line">    buildToolsVersion rootProject.buildToolsVersion</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">"com.example.android.testing.espresso.BasicSample"</span></span><br><span class="line">        minSdkVersion <span class="number">10</span></span><br><span class="line">        targetSdkVersion <span class="number">24</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">"1.0"</span></span><br><span class="line"></span><br><span class="line">        testInstrumentationRunner <span class="string">"android.support.test.runner.AndroidJUnitRunner"</span></span><br><span class="line">    &#125;</span><br><span class="line">    lintOptions &#123;</span><br><span class="line">        abortOnError <span class="keyword">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    productFlavors &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="comment">// App dependencies</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:support-annotations:'</span> + rootProject.supportLibVersion;</span><br><span class="line">    <span class="keyword">compile</span> <span class="string">'com.google.guava:guava:18.0'</span></span><br><span class="line">    <span class="comment">// Testing-only dependencies</span></span><br><span class="line">    <span class="comment">// Force usage of support annotations in the test app, since it is internally used by the runner module.</span></span><br><span class="line">    androidTestCompile <span class="string">'com.android.support:support-annotations:'</span> + rootProject.supportLibVersion;</span><br><span class="line">    androidTestCompile <span class="string">'com.android.support.test:runner:'</span> + rootProject.runnerVersion;</span><br><span class="line">    androidTestCompile <span class="string">'com.android.support.test:rules:'</span> + rootProject.rulesVersion;</span><br><span class="line">    androidTestCompile <span class="string">'com.android.support.test.espresso:espresso-core:'</span> + rootProject.espressoVersion;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>之后我们只需要在命令行中输入gradle就会帮我们下载依赖运行测试了，对了记着要安装gradle到你的系统中.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/31/qaquilty/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qi lei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QA seven's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/31/qaquilty/" itemprop="url">从QA的角度来谈谈代码质量的改进</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-31T22:15:46+08:00">
                2016-10-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>大部分人看到这个题目时，直接的反应是QA关心代码质量干嘛，能看懂代码吗？怎么给dev feedback？</p>
<p><img src="/image/qa.gif" alt="qa"></p>
<p>如果还有人持这样的观点后，那么我只能说too young too simple。<br>首先我们得谈谈什么是代码质量？<br>创建优秀的代码涉及到正确性、可维护性甚至优美性。<br>正确性，最起码你的代码实现的业务逻辑是正确的。<br>可维护性，公司中其他的小伙伴能看看懂你的代码逻辑，便于修改代码。<br>优美性，符合各种代码规范，其他人看到代码后惊为天人。<br>但是要做到以上几点绝非易事，首先你得有高超的编程能力，其次你对前端或后端的代码规范有深刻的理解，但是能有这样能力的人又有多少呢？<br>我们都知道软件开发是团队合作才能完成的工作。<br>那么项目的质量与客户的需求才是项目生存下去的关键。<br>所以怎么才能改进项目代码的质量？我们先看看业界巨头公司都是如何做的？</p>
<h2 id="microsoft_u600E_u4E48_u505A_uFF1F"><a href="#microsoft_u600E_u4E48_u505A_uFF1F" class="headerlink" title="microsoft怎么做？"></a>microsoft怎么做？</h2><p><img src="/image/mircosoft.jpg" alt="microsoft"></p>
<p>我们都知道微软是做操作系统出身的，其实微软的测试能力与测试工具都是业界中领先的，以下是两张表展示的是微软如何从visual studio与开发过程中提高代码质量</p>
<h4 id="Visual_Studio"><a href="#Visual_Studio" class="headerlink" title="Visual Studio"></a>Visual Studio</h4><table>
<thead>
<tr>
<th>标准</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>使用代码分析工具分析应用程序质量</td>
<td>静态代码分析工具可查找 C++ 和托管代码里的设计、使用、可维护性和样式问题。 其中的许多问题可能导致难以在标准测试环境中重现的 bug。</td>
</tr>
<tr>
<td>单元测试代码</td>
<td>“测试资源管理器”可以在开发实践中轻松地集成单元测试。 可以使用 Microsoft 单元测试框架或若干第三方和开源框架之一。</td>
</tr>
<tr>
<td>  测量托管代码的复杂性和可维护性</td>
<td>代码度量是一组软件度量值，使开发人员可以更好地了解他们正在开发的代码。 度量值包括函数和类的可维护性指数、函数的圈复杂度、类的继承深度和类耦合度的数值。</td>
</tr>
<tr>
<td>  使用代码克隆检测功能查找重复代码</td>
<td>代码克隆工具可用于在整个 Visual Studio 解决方案内搜索 Visual C# 和 Visual Basic 项目中重复或高度相似的代码。 可以经常重构代码以消除重复代码，从而创建更易于维护的解决方案。</td>
</tr>
<tr>
<td>  PreEmptive Analytics for Team Foundation Server</td>
<td>PreEmptive Analytics for TFS CE 有助于将反馈驱动的开发过程集成到开发工作流中。 当应用程序在执行过程中发生错误时，它会自动将异常报告数据发回给 PreEmptive Analytics 服务。 然后，该服务将根据你定义的规则和阈值创建或更新 Microsoft Team Foundation Server 中的工作项。  </td>
</tr>
<tr>
<td>  PreEmptive Dotfuscator 和 Analytics CE</td>
<td>PreEmptive Dotfuscator 是 .NET 模糊处理程序和压缩程序，有助于防止程序遭遇反向工程，同时使程序更小更高效。</td>
</tr>
</tbody>
</table>
<h4 id="u5F00_u53D1_u8FC7_u7A0B_u4E2D_u6539_u8FDB_u4EE3_u7801_u8D28_u91CF"><a href="#u5F00_u53D1_u8FC7_u7A0B_u4E2D_u6539_u8FDB_u4EE3_u7801_u8D28_u91CF" class="headerlink" title="开发过程中改进代码质量"></a>开发过程中改进代码质量</h4><table>
<thead>
<tr>
<th>标准</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>  设计和代码的检查准则</td>
<td>提供若干帮助进行设计和代码检查的技术，通过让其他同事检查代码来发现 bug 和不正确的假设。</td>
</tr>
<tr>
<td>  安全代码编写准则</td>
<td>描述编写安全代码的技术和策略。  </td>
</tr>
<tr>
<td>  高质量代码签入准则</td>
<td>列出以不同方式检查代码以确保代码实现您的预期高质量设计目的的准则。</td>
</tr>
<tr>
<td>  代码分析工具使用准则</td>
<td>提供几条使用代码分析工具的准则。  </td>
</tr>
<tr>
<td>  检测和更正 C/C++ 代码缺陷</td>
<td>描述如何使用用于托管代码的代码分析工具检测和更正代码缺陷。</td>
</tr>
<tr>
<td>  代码分析签入策略</td>
<td>描述如何创建与 Team Foundation 源控件签入关联的自定义签入策略。</td>
</tr>
<tr>
<td>调试准则</td>
<td>提供几条查找代码缺陷的准则。</td>
</tr>
</tbody>
</table>
<h2 id="google__u53C8_u662F_u600E_u4E48_u505A_uFF1F"><a href="#google__u53C8_u662F_u600E_u4E48_u505A_uFF1F" class="headerlink" title="google 又是怎么做？"></a>google 又是怎么做？</h2><p><img src="/image/google.jpg" alt="google"></p>
<ul>
<li><p>代码审查。在你提交任何代码改动之前，你得找去代码“主人”签字确认。为了实现，评审者（被鼓励去）建议大修代码，而不是让它成为根本没有经过思考的“图章”代码。</p>
</li>
<li><p>按语言可读性要求坚持代码风格指南（请参阅这里）。除了让我们代码有统一的外观（所以我们能快速识别方法、变了等），我们的风格指南禁止了一些复杂、混乱、易出错的 C++ 特性（比如：class 类型的静态和全局变量）。</p>
</li>
<li><p>整个团队都致力改进我们代码库的质量，维护我们的核心库，不断做出更好的工具。</p>
</li>
<li><p>一个活跃的“code health”课题组。</p>
</li>
<li>发布软件时，不对外部期限承担责任。一般而言，这让我们可以正确做事，而非为了期限内完成任务把乱七八糟的代码拼凑起来。</li>
<li>“Fix it.” 例如，一个工程师或许说，“我认为我们真应该别再用过时的  Cruft Map 类（class）了。我打算在 1 月 20 日组织一次 Fix it。” 当 1 月 20 日来临时，大家应当暂停其正常运作，把他们代码中的 Cruft Maps 都换掉。在 1 月 21 日，Google 就永远和 Cruft Map 说拜拜了！不过最近，核心库团队已经很优秀了，貌似没有啥东西可再值得类似的 fix it 了。</li>
<li>测试文化。单元测试覆盖率可能接近 100%，我们有持续构建/整合/测试，还有知名的 “Testing on the Toilet” (请参见Google Testing Blog)</li>
</ul>
<h2 id="facebook__u5462_uFF1F__u53C8_u6709_u4EC0_u4E48_u4E0D_u4E00_u6837"><a href="#facebook__u5462_uFF1F__u53C8_u6709_u4EC0_u4E48_u4E0D_u4E00_u6837" class="headerlink" title="facebook 呢？ 又有什么不一样"></a>facebook 呢？ 又有什么不一样</h2><p><img src="/image/facebook.jpeg" alt="facebook"></p>
<ul>
<li>开发对质量负责： 开发从设计，实现，测试，到部署都要自己做。其它做工具，流程的工程师通过开发工具和流程来帮助开发人员更为简单方便地做测试，做部署和做监控。每个开发人员有自己单独的测试环境，测试环境就是运行在开发本地机器上，部署非常简单快速。测试环境用的是真实的用户数据。</li>
<li>持续集成和测试自动化：每周发布一次。星期天晚上，要发布的构建从主线上分支出来到发布分支，到星期二的中午如果没有大的问题，就可以上线了。所有的测试运行控制在10分钟以内，所以不需要考虑不运行哪些测试用例。运行所有测试用例。 （只是听说，没有经过考证。）</li>
<li>严格实施代码审计：在Facebook 做 code review时间大约占50%，管理者对代码质量负有一定责任 。甚至代码质量高于一切：Facebook Code review是重点KPI考核的对象，实行连坐制，如果因为代码质量问题，那么产生的KPI责任包括领导30％、程序员50％、审核人员20％。 在代码checkin之前，都要由专人进行review。Facebook 创始人兼 CEO 马克扎克伯格会亲自对 News Feed 每个代码更新把关。在 Facebook，所有重大升级的代码都进行强制评估，任何一个改动都至少由一人把关。但是，无论工程师对 News Feed 做出任何改动，都将由扎克伯格亲自把关。</li>
<li>内测 （dog food）：发布之前，公司员工使用要发布的功能。2－3天之内可以有几百个或上千个人在使用新功能。负责要发布功能的开发人员在星期天晚上到星期二中午之间会做大量的测试 。</li>
<li>通过灰度发布控制风险：新功能本身质量可能有问题，新功能也可能影响其它现有功能。为了减少或控制这些风险。Facebook开发了一整套完善的发布，控制，监控流程和工具。做到：1.测试通过后，产品质量基本有保证。2.即使有漏测的bug，只会影响很少量的用户。3.及时监控到问题。4.及时修复。</li>
<li>产品监控：通过社区讨论的正负面舆情，及与历史应用数据的对比情况，监控产品的系统的运行状态技术修复。<h2 id="thoughtworks__u4E1A_u754C_u4EE5_u654F_u6377_u8457_u79F0_u7684_u8F6F_u4EF6_u4F01_u4E1A_u53C8_u662F_u5982_u4F55_u6539_u8FDB_u7684"><a href="#thoughtworks__u4E1A_u754C_u4EE5_u654F_u6377_u8457_u79F0_u7684_u8F6F_u4EF6_u4F01_u4E1A_u53C8_u662F_u5982_u4F55_u6539_u8FDB_u7684" class="headerlink" title="thoughtworks 业界以敏捷著称的软件企业又是如何改进的"></a>thoughtworks 业界以敏捷著称的软件企业又是如何改进的</h2><img src="/image/thoughtworks.jpg" alt="thoughtworks"></li>
</ul>
<ul>
<li>项目的初期，dev,BA,QA就会做到一起IPM,让不同的角色都能了解story，让dev尽早的分析story以及采用那种技术去完成工作。<br><img src="/image/twqa.jpg" alt="pair"></li>
</ul>
<ul>
<li>开发阶段，dev会采用pair的方式，和QA，其他dev共同完成story，这样的好处是，一让不熟悉的新人尽快的了解项目架构，二与QApair,QA将会提供dev考虑不足的点，一起编写单元测试以及feature test。</li>
<li>当dev完成代码工作后，会在github上发出pull request 或邀请其他dev，一起评审代码。</li>
<li>各个项目都有自己完备的cd流程，确保发布过程的正确性，减少人为手工操作的失误。</li>
</ul>
<p>从以上业界代表公司的改进方式，我们可以看出它们都是从以下几点出发的：</p>
<ol>
<li>完整的单元测试覆盖率<br>UI自动化测试的覆盖率很难被保证，不断的改变的ui,使使用UI测试来验证产品的功能变得十分麻烦，但是单元测试则不同，各种语言都有自己的测试工具以及测试覆盖率工具帮助我们更好的完善我们的代码质量，我们也可以用接口测试与pact测试来保证第三方集成服务的正确性，所以高覆盖率的单元测试时产品的质量的基础。</li>
<li>严格的代码审查机制<br>facebook，google，微软等公司严格的代码审查机制，是确保代码不被破坏的关键点，不会因为团队成员的某次粗心的提交，造成整个项目的失败。</li>
<li><p>强大的代码分析工具<br>代码级别的规范化，以及动态与静态扫描，进一步的帮助软件开发人员、质量保证人员查找代码中存在的结构性错误、安全漏洞等问题，从而保证软件的整体质量。与CI,CD的集成，能够让我们尽早的发现代码中存在的错误。</p>
</li>
<li><p>规范化的测试流程<br>各个公司规范化的测试流程，保证项目在每一阶段都能够输出高质量的代码。</p>
</li>
<li>完善的风险控制<br>完善的风险控制，不仅仅表现的google与Facebook的A/B测试，也表现在当有任何重大问题时，能够随意的切换到旧的版本，保证产品不因为该问题，就造成宕机。</li>
<li>实时的监控<br>这些行业的巨头，都有着非常强大的运维团队，从产品的开发阶段就开始实施了各种监控手段，监控范围包括编译阶段，部署阶段，产品环境，硬件服务器的状态等，帮助项目的中所有成员及时的发现产品中存在的问题，快速跟踪以及定位问题。</li>
</ol>
<p><strong>第一篇分析各个公司都采取了那些代码质量改进措施完毕，接下来我会从不同的角度去详细介绍这些改进措施。
</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/01/capybara5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qi lei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QA seven's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/01/capybara5/" itemprop="url">capybara5--实现你第一个自动化场景</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-01T22:31:15+08:00">
                2016-09-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="u5B9E_u73B0_u4F60_u7B2C_u4E00_u4E2A_u81EA_u52A8_u5316_u573A_u666F"><a href="#u5B9E_u73B0_u4F60_u7B2C_u4E00_u4E2A_u81EA_u52A8_u5316_u573A_u666F" class="headerlink" title="实现你第一个自动化场景"></a>实现你第一个自动化场景</h2><p>万事俱备，只欠东风，让我们来实现我们一个自动化测试场景，百度上搜索capybara。</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">describe <span class="string">"i want search capybara"</span>,  :type =&gt; :feature <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    context <span class="comment">'i need to open browser' do</span></span><br><span class="line">      it <span class="comment">'should be  has an browser'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">    context <span class="comment">'when i input baidu url into the browser textarea' do</span></span><br><span class="line">      it <span class="comment">'should be redirect  to the baidu homepage'</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">    context <span class="comment">'when i input the capybara into search text ' do</span></span><br><span class="line">      it <span class="comment">'responds with 200 and show the result'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<hr>
<p>rspec 与 cucumber完整的使用指南并不包含在本书的范畴，但我会给大家讲解基本的项目架构与语法，帮助大家更好的理解capybara和自动化测试的规范。</p>
<h3 id="rspec_u65B9_u5F0F"><a href="#rspec_u65B9_u5F0F" class="headerlink" title="rspec方式"></a>rspec方式</h3><p>对于基于rspec框架的项目，我们首先需要创建spec目录，来将我们的测试文件放置当中，这样做使我们项目代码结构更加清晰。<br>此外我们还需要创建spec/rspec_help.rb文件帮助我们设置测试的配置信息。</p>
<p>如果你的项目是基于rails的，那么就更简单了，你只需要执行以下命令，系统就帮助我们完成这些基础配置和文件的生成</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails generate rspec:<span class="keyword">install</span></span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.rspec</span></span><br><span class="line">spec/spec_helper<span class="class">.rb</span></span><br><span class="line">spec/rails_helper.rb</span><br></pre></td></tr></table></figure>
<p>让我正式开始<br>首先我们需要配置spec_helper.rb文件，<br>将以下内容复制到spec_helper.rb中，稍后章节中我将具体介绍配置文件中每条代码实际的作用</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">require <span class="string">"capybara/rspec"</span></span><br><span class="line">require <span class="string">"capybara"</span></span><br><span class="line">require <span class="string">"rspec"</span></span><br><span class="line">require <span class="string">'pry'</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Capybara.</span>default_driver = <span class="symbol">:selenium</span></span><br><span class="line"><span class="constant">Capybara.</span>app_host = <span class="string">'http://www.baidu.com'</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Capybara.</span>register_driver <span class="symbol">:selenium</span> <span class="keyword">do</span> |app| <span class="constant">Capybara:</span><span class="symbol">:Selenium</span><span class="symbol">:</span><span class="symbol">:Driver</span>.new(</span><br><span class="line">app, <span class="symbol">:browser</span> =&gt; <span class="symbol">:chrome</span> )</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This file was generated by the `rspec --init` command. Conventionally, all</span></span><br><span class="line"><span class="comment"># specs live under a `spec` directory, which RSpec adds to the `$LOAD_PATH`.</span></span><br><span class="line"><span class="comment"># The generated `.rspec` file contains `--require spec_helper` which will cause</span></span><br><span class="line"><span class="comment"># this file to always be loaded, without a need to explicitly require it in any</span></span><br><span class="line"><span class="comment"># files.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Given that it is always loaded, you are encouraged to keep this file as</span></span><br><span class="line"><span class="comment"># light-weight as possible. Requiring heavyweight dependencies from this file</span></span><br><span class="line"><span class="comment"># will add to the boot time of your test suite on EVERY test run, even for an</span></span><br><span class="line"><span class="comment"># individual file that may not need all of that loaded. Instead, consider making</span></span><br><span class="line"><span class="comment"># a separate helper file that requires the additional dependencies and performs</span></span><br><span class="line"><span class="comment"># the additional setup, and require it from the spec files that actually need</span></span><br><span class="line"><span class="comment"># it.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The `.rspec` file also contains a few flags that are not defaults but that</span></span><br><span class="line"><span class="comment"># users commonly want.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See http://rubydoc.info/gems/rspec-core/RSpec/Core/Configuration</span></span><br><span class="line"><span class="constant">RSpec.</span>configure <span class="keyword">do</span> |config|</span><br><span class="line"></span><br><span class="line">  <span class="comment"># rspec-expectations config goes here. You can use an alternate</span></span><br><span class="line">  <span class="comment"># assertion/expectation library such as wrong or the stdlib/minitest</span></span><br><span class="line">  <span class="comment"># assertions if you prefer.</span></span><br><span class="line"></span><br><span class="line">  config.expect_with <span class="symbol">:rspec</span> <span class="keyword">do</span> |expectations|</span><br><span class="line">    <span class="comment"># This option will default to `true` in RSpec 4. It makes the `description`</span></span><br><span class="line">    <span class="comment"># and `failure_message` of custom matchers include text for helper methods</span></span><br><span class="line">    <span class="comment"># defined using `chain`, e.g.:</span></span><br><span class="line">    <span class="comment">#     be_bigger_than(2).and_smaller_than(4).description</span></span><br><span class="line">    <span class="comment">#     # =&gt; "be bigger than 2 and smaller than 4"</span></span><br><span class="line">    <span class="comment"># ...rather than:</span></span><br><span class="line">    <span class="comment">#     # =&gt; "be bigger than 2"</span></span><br><span class="line">    expectations.include_chain_clauses_in_custom_matcher_descriptions = <span class="keyword">true</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># rspec-mocks config goes here. You can use an alternate test double</span></span><br><span class="line">  <span class="comment"># library (such as bogus or mocha) by changing the `mock_with` option here.</span></span><br><span class="line">  config.mock_with <span class="symbol">:rspec</span> <span class="keyword">do</span> |mocks|</span><br><span class="line">    <span class="comment"># Prevents you from mocking or stubbing a method that does not exist on</span></span><br><span class="line">    <span class="comment"># a real object. This is generally recommended, and will default to</span></span><br><span class="line">    <span class="comment"># `true` in RSpec 4.</span></span><br><span class="line">    mocks.verify_partial_doubles = <span class="keyword">true</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># This option will default to `:apply_to_host_groups` in RSpec 4 (and will</span></span><br><span class="line">  <span class="comment"># have no way to turn it off -- the option exists only for backwards</span></span><br><span class="line">  <span class="comment"># compatibility in RSpec 3). It causes shared context metadata to be</span></span><br><span class="line">  <span class="comment"># inherited by the metadata hash of host groups and examples, rather than</span></span><br><span class="line">  <span class="comment"># triggering implicit auto-inclusion in groups with matching metadata.</span></span><br><span class="line">  config.shared_context_metadata_behavior = <span class="symbol">:apply_to_host_groups</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The settings below are suggested to provide a good initial experience</span></span><br><span class="line"><span class="comment"># with RSpec, but feel free to customize to your heart's content.</span></span><br><span class="line">=<span class="keyword">begin</span></span><br><span class="line">  <span class="comment"># This allows you to limit a spec run to individual examples or groups</span></span><br><span class="line">  <span class="comment"># you care about by tagging them with `:focus` metadata. When nothing</span></span><br><span class="line">  <span class="comment"># is tagged with `:focus`, all examples get run. RSpec also provides</span></span><br><span class="line">  <span class="comment"># aliases for `it`, `describe`, and `context` that include `:focus`</span></span><br><span class="line">  <span class="comment"># metadata: `fit`, `fdescribe` and `fcontext`, respectively.</span></span><br><span class="line">  config.filter_run_when_matching <span class="symbol">:focus</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Allows RSpec to persist some state between runs in order to support</span></span><br><span class="line">  <span class="comment"># the `--only-failures` and `--next-failure` CLI options. We recommend</span></span><br><span class="line">  <span class="comment"># you configure your source control system to ignore this file.</span></span><br><span class="line">  config.example_status_persistence_file_path = <span class="string">"spec/examples.txt"</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Limits the available syntax to the non-monkey patched syntax that is</span></span><br><span class="line">  <span class="comment"># recommended. For more details, see:</span></span><br><span class="line">  <span class="comment">#   - http://rspec.info/blog/2012/06/rspecs-new-expectation-syntax/</span></span><br><span class="line">  <span class="comment">#   - http://www.teaisaweso.me/blog/2013/05/27/rspecs-new-message-expectation-syntax/</span></span><br><span class="line">  <span class="comment">#   - http://rspec.info/blog/2014/05/notable-changes-in-rspec-3/#zero-monkey-patching-mode</span></span><br><span class="line">  config.disable_monkey_patching!</span><br><span class="line"></span><br><span class="line">  <span class="comment"># This setting enables warnings. It's recommended, but in some cases may</span></span><br><span class="line">  <span class="comment"># be too noisy due to issues in dependencies.</span></span><br><span class="line">  config.warnings = <span class="keyword">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Many RSpec users commonly either run the entire suite or an individual</span></span><br><span class="line">  <span class="comment"># file, and it's useful to allow more verbose output when running an</span></span><br><span class="line">  <span class="comment"># individual spec file.</span></span><br><span class="line">  if config.files_to_run.one?</span><br><span class="line">    <span class="comment"># Use the documentation formatter for detailed output,</span></span><br><span class="line">    <span class="comment"># unless a formatter has already been configured</span></span><br><span class="line">    <span class="comment"># (e.g. via a command-line flag).</span></span><br><span class="line">    config.default_formatter = <span class="string">'doc'</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Print the 10 slowest examples and example groups at the</span></span><br><span class="line">  <span class="comment"># end of the spec run, to help surface which specs are running</span></span><br><span class="line">  <span class="comment"># particularly slow.</span></span><br><span class="line">  config.profile_examples = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Run specs in random order to surface order dependencies. If you find an</span></span><br><span class="line">  <span class="comment"># order dependency and want to debug it, you can fix the order by providing</span></span><br><span class="line">  <span class="comment"># the seed, which is printed after each run.</span></span><br><span class="line">  <span class="comment">#     --seed 1234</span></span><br><span class="line">  config.order = <span class="symbol">:random</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Seed global randomization in this process using the `--seed` CLI option.</span></span><br><span class="line">  <span class="comment"># Setting this allows you to use `--seed` to deterministically reproduce</span></span><br><span class="line">  <span class="comment"># test failures related to randomization by passing the same `--seed` value</span></span><br><span class="line">  <span class="comment"># as the one that triggered the failure.</span></span><br><span class="line">  <span class="constant">Kernel.</span>srand config.seed</span><br><span class="line">=<span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>我们执行以下命令来运行我们的测试</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lqi @ CNlqi in ~/work/test/capybara_demo on git:master x [22:00:31]</span></span><br><span class="line">$ rspec ./spec/features/baidusearch_spec.rb</span><br><span class="line">***</span><br><span class="line"></span><br><span class="line"><span class="type">Pending</span>: (<span class="type">Failures</span> listed here are expected <span class="keyword">and</span> <span class="keyword">do</span> <span class="keyword">not</span> affect your suite's status)</span><br><span class="line"></span><br><span class="line">  <span class="number">1</span>) i want search capybara i need to open browser should be  has an browser</span><br><span class="line">     <span class="comment"># Not yet implemented</span></span><br><span class="line">     <span class="comment"># ./spec/features/bb_spec.rb:9</span></span><br><span class="line"></span><br><span class="line">  <span class="number">2</span>) i want search capybara <span class="keyword">when</span> i input baidu url into the browser textarea should be redirect  to the baidu homepage</span><br><span class="line">     <span class="comment"># Not yet implemented</span></span><br><span class="line">     <span class="comment"># ./spec/features/bb_spec.rb:16</span></span><br><span class="line"></span><br><span class="line">  <span class="number">3</span>) i want search capybara <span class="keyword">when</span> i input the capybara into search text  responds <span class="keyword">with</span> <span class="number">200</span> <span class="keyword">and</span> show the <span class="literal">result</span></span><br><span class="line">     <span class="comment"># Not yet implemented</span></span><br><span class="line">     <span class="comment"># ./spec/features/bb_spec.rb:20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">Finished</span> <span class="keyword">in</span> <span class="number">0</span>.<span class="number">00059</span> seconds (files took <span class="number">1</span>.<span class="number">37</span> seconds to load)</span><br><span class="line"><span class="number">3</span> examples, <span class="number">0</span> failures, <span class="number">3</span> pending</span><br></pre></td></tr></table></figure>
<p>我们从测试结果能看出，我们并没有实现任何具体操作步骤，接下就让我们完成这些工作。<br>将我们测试文件baidusearch_spec.rb修改为以下内容</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">describe</span> <span class="string">"i want search capybara"</span>,  :<span class="keyword">type</span> =&gt; :feature <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">context</span> <span class="string">"the page"</span> <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">before</span> <span class="keyword">do</span></span><br><span class="line">      page.driver.browser.manage.window.resize_to(<span class="number">1440</span>,<span class="number">900</span>) #Mention it here</span><br><span class="line">      visit <span class="string">"/"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">context</span> <span class="string">'i need to open browser'</span> <span class="keyword">do</span></span><br><span class="line">      it <span class="string">'should be  has an browser'</span> <span class="keyword">do</span></span><br><span class="line">      expect(page.driver.browser.browser).<span class="keyword">to</span> eq :chrome</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">context</span> <span class="string">'when i input baidu url into the browser textarea'</span> <span class="keyword">do</span></span><br><span class="line">      it <span class="string">'should be redirect  to the baidu homepage'</span> <span class="keyword">do</span></span><br><span class="line">       expect(page.driver.current_url).<span class="keyword">to</span> eq(<span class="string">'https://www.baidu.com/'</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">    <span class="keyword">context</span> <span class="string">'when i input the capybara into search text '</span> <span class="keyword">do</span></span><br><span class="line">      it <span class="string">' show search the result'</span> <span class="keyword">do</span></span><br><span class="line">        fill_in <span class="string">'kw'</span>, :<span class="keyword">with</span> =&gt; <span class="string">'capybara'</span></span><br><span class="line">        click_button <span class="string">'百度一下'</span></span><br><span class="line">        expect(page).<span class="keyword">to</span> have_content <span class="string">'Capybara - Wikipedia, the free encyclopedia'</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span></span><br></pre></td></tr></table></figure>
<p>再次运行测试<br>这时浏览器打开并且按照我们测试文件中具体步骤一步一步进行操作和验证，全部通过</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># lqi @ CNlqi in ~/work/test/capybara_demo on git:master x [<span class="number">22</span>:<span class="number">26</span>:<span class="number">15</span>] C:<span class="number">1</span></span></span><br><span class="line">$ rspec ./spec/features/baidusearch_spec.rb</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Finished in <span class="number">5.46</span> seconds (files took <span class="number">3.81</span> seconds to load)</span><br><span class="line"><span class="number">3</span> examples, <span class="number">0</span> failures</span><br></pre></td></tr></table></figure>
<h3 id="cucumber_u65B9_u5F0F"><a href="#cucumber_u65B9_u5F0F" class="headerlink" title="cucumber方式"></a>cucumber方式</h3><p>首先我们运行cucumber查看cucumber是否安装正确<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># lqi @ CNlqi <span class="keyword">in</span> ~/work/<span class="keyword">test</span>/capybara_demo <span class="keyword">on</span> git:master x [13:42:41]</span><br><span class="line">$ cucumber</span><br><span class="line"><span class="keyword">No</span> such <span class="keyword">file</span> or directory - features. You can <span class="keyword">use</span> `cucumber --init` to get started.</span><br></pre></td></tr></table></figure></p>
<p>当我们看到以上提示没有文件或者目录时，我们就可以确认cucumber安装成功<br>接下来让我们初始化cucumber测试目录结构<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lqi @ CNlqi in ~/work/test/capybara_demo on git:master x [11:24:56] C:2</span></span><br><span class="line">$ cucumber <span class="comment">--init</span></span><br><span class="line">  <span class="built_in">create</span>   features</span><br><span class="line">  <span class="built_in">create</span>   features/step_definitions</span><br><span class="line">  <span class="built_in">create</span>   features/support</span><br><span class="line">  <span class="built_in">create</span>   features/support/env.rb</span><br></pre></td></tr></table></figure></p>
<p>这样就完成目录结构的初始化，我们要将所有feature文件都放到features目录下<br>support目录下，使我们需要的一些配置文件.</p>
<p>step<em>definitions目录下，是对feature文件中的具体操作实现。因为我们都知道feature文件中只是做了一些描述，具体的执行是放到step</em> definitions下面的文件里面的。<br>接下来，我们用cucumber完成和上面spec一样的场景。<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Feature</span>: <span class="type">Search</span> <span class="keyword">for</span> capybara on baidu</span><br><span class="line">      <span class="type">Scenario</span>: <span class="type">Search</span> <span class="keyword">for</span> website <span class="keyword">of</span> baidu</span><br><span class="line">          <span class="type">Given</span> I am on the baidu home page</span><br><span class="line">          <span class="type">When</span> I search <span class="keyword">for</span> <span class="string">"capybara"</span></span><br><span class="line">          <span class="type">Then</span> website <span class="keyword">of</span> search <span class="literal">result</span> are returned</span><br></pre></td></tr></table></figure></p>
<p>在命令行中运行cucumber命令，<br>运行上述测试用例，便可以看到下列输出，你可以使用下面的代码段实现步骤定义：<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lqi @ CNlqi in ~/work/test/capybara_demo on git:master x [14:25:16] C:1</span></span><br><span class="line">$ cucumber</span><br><span class="line">Feature: Search <span class="keyword">for</span> capybara <span class="command"><span class="keyword">on</span> <span class="title">baidu</span></span></span><br><span class="line"></span><br><span class="line">  Scenario: Search <span class="keyword">for</span> website <span class="operator">of</span> baidu        <span class="comment"># features/baidu_search_capybara.feature:2</span></span><br><span class="line">    Given I am <span class="command"><span class="keyword">on</span> <span class="title">the</span> <span class="title">baidu</span> <span class="title">home</span> <span class="title">page</span>          # <span class="title">features</span>/<span class="title">baidu_search_capybara</span>.<span class="title">feature</span>:<span class="title">3</span></span></span><br><span class="line">    When I search <span class="keyword">for</span> <span class="string">"capybara"</span>               <span class="comment"># features/baidu_search_capybara.feature:4</span></span><br><span class="line">    Then website <span class="operator">of</span> search <span class="built_in">result</span> are returned <span class="comment"># features/baidu_search_capybara.feature:5</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span> scenario (<span class="number">1</span> undefined)</span><br><span class="line"><span class="number">3</span> steps (<span class="number">3</span> undefined)</span><br><span class="line"><span class="number">0</span>m0<span class="number">.395</span>s</span><br><span class="line"></span><br><span class="line">You can implement step definitions <span class="keyword">for</span> undefined steps <span class="operator">with</span> these snippets:</span><br><span class="line"></span><br><span class="line">Given(/^I am <span class="command"><span class="keyword">on</span> <span class="title">the</span> <span class="title">baidu</span> <span class="title">home</span> <span class="title">page</span>$/) <span class="title">do</span></span></span><br><span class="line">  pending <span class="comment"># Write code here that turns the phrase above into concrete actions</span></span><br><span class="line"><span class="function"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="title">When</span>(/^<span class="title">I</span> <span class="title">search</span> <span class="title">for</span> "([^"]*)"$/) <span class="title">do</span> |<span class="title">arg1</span>|</span></span><br><span class="line">  pending <span class="comment"># Write code here that turns the phrase above into concrete actions</span></span><br><span class="line"><span class="function"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="title">Then</span>(/^<span class="title">website</span> <span class="title">of</span> <span class="title">search</span> <span class="title">result</span> <span class="title">are</span> <span class="title">returned</span>$/) <span class="title">do</span></span></span><br><span class="line">  pending <span class="comment"># Write code here that turns the phrase above into concrete actions</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>复制以上代码到具体step.rb文件中，我们新建文件capybara_search_step.rb。<br>再次运行cucumber命令<br>现在,您将看到命令行报告,这些步骤已经存在但没有实现:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># lqi @ CNlqi in ~/work/test/capybara_demo on git:master x [<span class="number">14</span>:<span class="number">25</span>:<span class="number">22</span>]</span></span><br><span class="line">$ cucumber</span><br><span class="line">Feature: Search <span class="keyword">for</span> capybara on baidu</span><br><span class="line"></span><br><span class="line">  Scenario: Search <span class="keyword">for</span> website of baidu        <span class="preprocessor"># features/baidu_search_capybara.feature:<span class="number">2</span></span></span><br><span class="line">    Given I am on the baidu home page          <span class="preprocessor"># features/step_definitions/capybara_search_step.rb:<span class="number">1</span></span></span><br><span class="line">      TODO (Cucumber::Pending)</span><br><span class="line">      ./features/step_definitions/capybara_search_step.rb:<span class="number">2</span>:in `/^I am on the baidu home page$/'</span><br><span class="line">      features/baidu_search_capybara.feature:<span class="number">3</span>:in `Given I am on the baidu home page'</span><br><span class="line">    When I search <span class="keyword">for</span> <span class="string">"capybara"</span>               <span class="preprocessor"># features/step_definitions/capybara_search_step.rb:<span class="number">5</span></span></span><br><span class="line">    Then website of search result are returned <span class="preprocessor"># features/step_definitions/capybara_search_step.rb:<span class="number">9</span></span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span> scenario (<span class="number">1</span> pending)</span><br><span class="line"><span class="number">3</span> steps (<span class="number">2</span> skipped, <span class="number">1</span> pending)</span><br><span class="line"><span class="number">0</span>m0<span class="number">.152</span>s</span><br></pre></td></tr></table></figure></p>
<p>接下来，我们通过增加少量的代码来使我们自动化运行起来。<br>首先确保你的env.rb文件配置如下：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'capybara/cucumber'</span></span><br><span class="line"><span class="constant">Capybara</span>.default_driver = <span class="symbol">:selenium</span></span><br></pre></td></tr></table></figure></p>
<p>首先，我们在文件中添加require ‘capybara/cucumber’;<br>这是我们必须需要加载文件。<br>之后我们需要告诉capybara使用selenium驱动：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Capybara<span class="class">.default_driver</span> = :selenium</span><br></pre></td></tr></table></figure></p>
<p>再次重申，capybara只是充当一个中间件，适配不同的dirver,使我们能够兼容任何的驱动程序,例如（Selecting the Driver，<br>RackTest，<br>Selenium，<br>Capybara-webkit，<br>Poltergeist）这里我们选择selemium webdriver 是因为它是目前最流行的开源浏览器自动化工具，很多公司的自动化框架都是基于它之上的二次开发而成，例如appium，淘宝的Automan X,网易Dagger等。</p>
<p>如果我们不设置驱动，将会得到以下错误<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lqi @ CNlqi in ~/work/test/capybara_demo on git:master x [17:13:47] C:2</span></span><br><span class="line"><span class="variable">$ </span>cucumber</span><br><span class="line">rack-test requires a rack application, but none was given (<span class="constant">ArgumentError</span>)</span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">capybara</span>-2.8.0/<span class="title">lib</span>/<span class="title">capybara</span>/<span class="title">rack_test</span>/<span class="title">driver</span>.<span class="title">rb</span>:17:<span class="title">in</span> `<span class="title">initialize</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">capybara</span>-2.8.0/<span class="title">lib</span>/<span class="title">capybara</span>.<span class="title">rb</span>:509:<span class="title">in</span> `<span class="title">new</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">capybara</span>-2.8.0/<span class="title">lib</span>/<span class="title">capybara</span>.<span class="title">rb</span>:509:<span class="title">in</span> `<span class="title">block</span> <span class="title">in</span> &lt;<span class="title">top</span> (<span class="title">required</span>)&gt;'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">capybara</span>-2.8.0/<span class="title">lib</span>/<span class="title">capybara</span>/<span class="title">session</span>.<span class="title">rb</span>:85:<span class="title">in</span> `<span class="title">call</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">capybara</span>-2.8.0/<span class="title">lib</span>/<span class="title">capybara</span>/<span class="title">session</span>.<span class="title">rb</span>:85:<span class="title">in</span> `<span class="title">driver</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/work/test/capybara_demo/features/support/env.<span class="symbol">rb:</span><span class="number">12</span>:in <span class="string">`&lt;top (required)&gt;'</span><br><span class="line">/Users/lqi/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/cucumber-2.4.0/lib/cucumber/rb_support/rb_language.rb:96:in `</span>load<span class="string">'</span><br><span class="line">/Users/lqi/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/cucumber-2.4.0/lib/cucumber/rb_support/rb_language.rb:96:in `load_code_file'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">cucumber</span>-2.4.0/<span class="title">lib</span>/<span class="title">cucumber</span>/<span class="title">runtime</span>/<span class="title">support_code</span>.<span class="title">rb</span>:142:<span class="title">in</span> `<span class="title">load_file</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">cucumber</span>-2.4.0/<span class="title">lib</span>/<span class="title">cucumber</span>/<span class="title">runtime</span>/<span class="title">support_code</span>.<span class="title">rb</span>:84:<span class="title">in</span> `<span class="title">block</span> <span class="title">in</span> <span class="title">load_files!</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">cucumber</span>-2.4.0/<span class="title">lib</span>/<span class="title">cucumber</span>/<span class="title">runtime</span>/<span class="title">support_code</span>.<span class="title">rb</span>:83:<span class="title">in</span> `<span class="title">each</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">cucumber</span>-2.4.0/<span class="title">lib</span>/<span class="title">cucumber</span>/<span class="title">runtime</span>/<span class="title">support_code</span>.<span class="title">rb</span>:83:<span class="title">in</span> `<span class="title">load_files!</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">cucumber</span>-2.4.0/<span class="title">lib</span>/<span class="title">cucumber</span>/<span class="title">runtime</span>.<span class="title">rb</span>:253:<span class="title">in</span> `<span class="title">load_step_definitions</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">cucumber</span>-2.4.0/<span class="title">lib</span>/<span class="title">cucumber</span>/<span class="title">runtime</span>.<span class="title">rb</span>:61:<span class="title">in</span> `<span class="title">run!</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">cucumber</span>-2.4.0/<span class="title">lib</span>/<span class="title">cucumber</span>/<span class="title">cli</span>/<span class="title">main</span>.<span class="title">rb</span>:32:<span class="title">in</span> `<span class="title">execute!</span>'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/<span class="class"><span class="keyword">lib</span>/<span class="title">ruby</span>/<span class="title">gems</span>/2.2.0/<span class="title">gems</span>/<span class="title">cucumber</span>-2.4.0/<span class="title">bin</span>/<span class="title">cucumber</span>:8:<span class="title">in</span> `&lt;<span class="title">top</span> (<span class="title">required</span>)&gt;'</span></span><br><span class="line">/<span class="constant">Users</span>/lqi/.rbenv/versions/<span class="number">2.2</span>.<span class="number">2</span>/bin/<span class="symbol">cucumber:</span><span class="number">23</span>:in <span class="string">`load'</span><br><span class="line">/Users/lqi/.rbenv/versions/2.2.2/bin/cucumber:23:in `</span>&lt;main&gt;<span class="string">'</span></span><br></pre></td></tr></table></figure></p>
<p>默认情况下，capybara被用来测试rack 应用。rack 是一个设计非常巧妙的中间件，被用作在rails与sinatra框架做全栈的Client/Server集成测试，并且没有什么HTTP的开销，从而是测试能够快速运行。稍后，我们将详细介绍capybara如何测试在rails与sinatra的应用测试。<br>接下来我们的任务就是你在步骤定义用Ruby代码调用capybaraAPI驱动测试。<br>将以下代码复制到你的capybara_search_step.rb中<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">Given</span>(<span class="regexp">/^I am on the baidu home page$/</span>) <span class="keyword">do</span></span><br><span class="line">  visit <span class="string">'https://www.baidu.com/'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="constant">When</span>(<span class="regexp">/^I search for "([^"]*)"$/</span>) <span class="keyword">do</span> |search_term|</span><br><span class="line">  fill_in <span class="string">'kw'</span>, <span class="symbol">:with</span> =&gt; search_term</span><br><span class="line">  click_on <span class="string">'su'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Then</span>(<span class="regexp">/^website of search result are returned$/</span>) <span class="keyword">do</span></span><br><span class="line">     page.should have_content <span class="string">'capybara'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>在我们分析代码之前,让我们先运行测试,看看会发生什么。像往常一样,在命令行中输入cucumber。<br>希望你能看到chrome打开，并且跳转到baidu首页，之后搜索到capybara结果并返回。<br>恭喜你，你已经利用capybara完成了第一个全栈的集成测试。</p>
<p>在我们深入了解capybara丰富的API之前，让我们简要的回顾一下每个步骤的内容，这里你可以看到capybra如何优雅而简洁使用api，代码字面含义已经向我们展示它在干什么，不需要多解释。cucumber和capybra配合起来使用，具有良好的可读性，项目中的任何一个角色都能够当前场景做了哪些事情，非常适合应用于自动化和维护工作。<br>第一行代码告诉capybara通知driver（selenium webdriver）<br>打开一个浏览器并跳转到我们提供的链接地址：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">visit</span> <span class="string">'https://www.baidu.com/'</span></span><br></pre></td></tr></table></figure></p>
<p>  接下来，我们需要输入查询条件，点击搜索按钮，所以我们告诉capybara去让driver在页面上查找搜输入栏，并填写搜索条件。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fill_in <span class="string">'kw'</span>, :<span class="keyword">with</span> =&gt; search_term</span><br><span class="line"></span><br><span class="line">click_on <span class="string">'su'</span></span><br></pre></td></tr></table></figure>
<p>这里唯一的困惑是fill_in 方法中使用’kw’这个关键字，当你代码告诉capybara去在页面上寻找<br>这个关键字时，capybara使用了一种’猜测’的机制。<br>也就是说capybra试图在DOM元素各种属性中找到你要求的。在这个例子中,我们知道baidu搜索表栏的id属性kw，这是我们需要在代码中提供的。<br>最后,我们需要检查返回的搜索结果是否正确。为此,我们使用capybara的内置RSpec匹配器。如果你不知道RSpec,rspec官方文档是你最好的选择(<a href="http://rspec.info/),与传统断言不同是当条件不满足时，会抛出异常，而不是只是返回false" target="_blank" rel="external">http://rspec.info/),与传统断言不同是当条件不满足时，会抛出异常，而不是只是返回false</a></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">page<span class="class">.should</span> have_content <span class="string">'capybara'</span></span><br></pre></td></tr></table></figure>
<p>最后需要注意的是,have_content方法的匹配器内置了一个默认的等待。这是非常有用的,因为如果查找的内容我是通过JavaScript异步加载而成的话(而不是在初始页面就加载完成),capybara在我们设置默认等待时间重试,看它是否存在。我们将在后面的章节介绍如何处理异步JavaScript的问题。</p>
<p>总结，本章目标是让你认识capybra，以及配置它的运行环境，ruby和rubygems以及相关依赖。最后，我们通过一个简单的场景来编写自动化，来加强我们的学习。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/30/capybara4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qi lei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QA seven's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/30/capybara4/" itemprop="url">capybara4--安装cucumber</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-30T15:54:19+08:00">
                2016-08-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>capybara是一个简单的API,它提供了抽象层在你真实自动化库之上。如果它帮助,认为capybara是你的翻译,你告诉它做一些事情，它将优雅的将命令转换为你应用驱动的API。</p>
<p>所以当我们使用capybara进行翻译时，我们需要告诉capybara做什么并且需要一个API自动化库去进行翻译。<br>capybara是一个非常灵活的库,<br>通过这本书我们将看到它在各种场景中应用。然而。目前为止最常见的情景是应用cucumber作为capybara测试驱动，去驱动selenium webdriver 开展浏览器自动化。<br>当cucumber被调用来解析这些简单易懂的英语场景时，它将使用正则表达式去将这些匹配</p>
<h2 id="cucumber_u4ECB_u7ECD"><a href="#cucumber_u4ECB_u7ECD" class="headerlink" title="cucumber介绍"></a>cucumber介绍</h2><p>cucumber是一种可以使用文本描述语言来执行自动测试用例的工具，使用的语言叫做Gherkin.</p>
<p>Gherkin用于描述软件的行为而不需要了解具体的实现，使用Gherkin主要有两个目的文档和自动测试用例（我们希望能够和手工测试用例也统一）。 Gherkin支持超过40种语言，包括英文、中文。 Gherkin可以在任何地方新增注释，注释以#开头，每一个文件都是已.feature结尾，在feature文件中输入功能描述、场景、步骤，当执行这个功能时每一个步骤都需要编写ruby代码块来实现具体的功能，当前cucumber支持多种语言，除了ruby还可以使用java、javascript来编写具体定义层的实现。</p>
<h3 id="u4EE5_u4E0B_u662F_u4E00_u4E2Acucumber__u573A_u666F_u7684_u4F8B_u5B50"><a href="#u4EE5_u4E0B_u662F_u4E00_u4E2Acucumber__u573A_u666F_u7684_u4F8B_u5B50" class="headerlink" title="以下是一个cucumber 场景的例子"></a>以下是一个cucumber 场景的例子</h3><p>   Feature: Search for Videos on Baidu</p>
<pre><code>Scenario: Search for Videos
    Given I am on the  baidu home page
    When I search for &quot;capybara&quot;
    Then search result are returned
</code></pre><p>我们设置可以采用中文实现场景<br>中文的话最前面必须增加# language: zh-CN</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># language: zh-CN</span></span><br><span class="line"></span><br><span class="line">功能:第一个中文程序</span><br><span class="line"></span><br><span class="line">中文实现</span><br><span class="line"></span><br><span class="line">场景:中文实现场景</span><br><span class="line"></span><br><span class="line">假如当前是中文</span><br><span class="line"></span><br><span class="line">当输入是测试</span><br><span class="line"></span><br><span class="line">那么能看到中文测试</span><br></pre></td></tr></table></figure>
<p>下面的流程图说明了从cucumber到底层驱动如何实现，capybara在整个流程里面充当是中间价的作用。</p>
<p><img src="/image/capybaraflow.png" alt=""></p>
<p>安装<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem <span class="keyword">install</span> cucumber</span><br></pre></td></tr></table></figure></p>
<p>如果你使用的是 bundler，只是需要添加以下代码到Gemfile:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">group <span class="symbol">:test</span> <span class="keyword">do</span></span><br><span class="line">  gem <span class="string">'cucumber'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>初始化features目录：<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cucumber <span class="comment">--init</span></span><br></pre></td></tr></table></figure></p>
<p>查看完帮助列表：<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cucumber <span class="comment">--help</span></span><br></pre></td></tr></table></figure></p>
<p>运行所有features：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cucumber</span><br></pre></td></tr></table></figure></p>
<h2 id="Cucumber-Rails"><a href="#Cucumber-Rails" class="headerlink" title="Cucumber-Rails"></a>Cucumber-Rails</h2><p>如果你使用capybara 来测试rails应用，你应该安装cucumber－rails gem 而不是标准的rails gem。<br>这个gem需要capybara和cucumber作为依赖。<br>所以当你安装cucumber－rails gem时，会自动安装这些依赖，我们只需要运行以下命令<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem <span class="keyword">install</span> cucumber-rails</span><br></pre></td></tr></table></figure></p>
<p>如果你使用bundle，只需要将以下代码添加进gemfile:<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">group <span class="symbol">:test</span>, <span class="symbol">:development</span> <span class="keyword">do</span></span><br><span class="line">  gem <span class="string">'cucumber-rails'</span>, <span class="symbol">:require</span> =&gt; <span class="keyword">false</span></span><br><span class="line">  <span class="comment"># database_cleaner is not required, but highly recommended</span></span><br><span class="line">  gem <span class="string">'database_cleaner'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>然后运行<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bundle </span>install</span><br></pre></td></tr></table></figure></p>
<p>运行生成器帮助我们生成目录<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails generate cucumber:<span class="keyword">install</span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="qi lei" />
          <p class="site-author-name" itemprop="name">qi lei</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qi lei</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  








  






  





  

  

  

  

  

  

</body>
</html>
